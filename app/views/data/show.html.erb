<% content_for :head do %>
  <%= stylesheet_link_merged 'data-show' %>
  <title><%= th.site_title %></title>
<% end %>

<div id="discover" class="oneColumnContainer">
  <div class="pageBlockHeaderOuter"><div class="pageBlockHeaderTL"><div class="pageBlockHeaderTR">
  <div class="pageBlockHeaderBL"><div class="pageBlockHeaderBR">
    <div class="pageBlockHeaderContainer">
      <div class="pageBlockIntro">
        <p><%= th.discover_header %></p>
      </div>
      <div class="pageBlockSearch">
        <p class="searchIntro"><%= t(:discover_search_intro) %></p>
        <% form_tag(data_filter_path, :class => "search large") do %>
          <div class="searchContainer">
            <%= text_field_tag("search", @search_term, :class => "textPrompt", :title => "Search") %>
            <%= hidden_field_tag("type", "SEARCH") %>

            <div class="actionsBox">
              <div class="clearBox">
                <a class="clearSearch" title="Clear Search" href="#clear_search">
                  Clear Search
                </a>
              </div>
              <%= image_submit_tag("find_button_large.png", :name => "discoverSubmit", :class => "submit") %>
            </div>
          </div>
        <% end %>
      </div>
      <div class="pageBlockHeaderContent clearfix">
        <% prerendered_cache "discover-carousel", @carousel_views_rendered, :expires_in => 15.minutes do %>
          <div class="pageBlockHeaderCarousel carouselWrapper">
            <div class="carouselOuter"><div class="carouselInner">
              <h2><%= t(:discover_carousel_header) %></h2>
              <ul id="featuredCarousel" class="jcarousel-skin-discover carousel">
                <%= render(:partial => "carousel_item", :collection => @carousel_views) %>
              </ul>
            </div></div>
          </div>
        <% end %>
        
        <%- if !@current_user.nil? -%>
          <div class="pageBlockHeaderSide">
            <h2>In My Network</h2>
            <ul class="myNetworkList">
              <%- @network_views.each do |view| -%>
                <li class="clearfix">
                  <%= link_to(h(view.name), view.href, :title => h(view.name), :class => "clipText") %> 
                  <span class="authorLine">by <%= h(view.owner.displayName) %></span>
                </li>
              <%- end -%>
            </ul>
          </div>
        <%- else -%>
          <%- if th.revolutionize -%>
            <%= render :partial => 'static/revolutionize_box' %>
          <%- else -%>
          <div class="pageBlockHeaderSide">
            <h2>Recent Activity</h2>
            <ul class="activityList">
              <%- @community_activity.each do |activity| -%>
                <li>
                  <%= get_html_for_activity(activity, "full") %>
                </li>
              <%- end -%>
            </ul>
          </div>
          <%- end -%>
        <%- end -%>
      </div>
    </div>
  </div></div>
  </div></div></div>
  
  <div class="simpleTabsContainer">
    <div class="simpleTabNav">
      <ul class="simpleTabs tabList clearfix">
        <%- if (@search_views && @search_views.length > 0) -%>
          <li id="tabSearch" class="active">
            <div class="wrapper"><a href="#SEARCH">Search Results</a></div>
          </li>
        <%- end -%>
        <li id="tabPopular" class="<%= @search_views.nil? ? 'even active' : 'even' %>">
          <div class="wrapper"><a href="#POPULAR">Top 100</a></div>
        </li>
        <li id="tabAll"><div class="wrapper"><a href="#ALL">All <%= t(:blists_name) %></a></div></li>
      </ul>
    </div>
    <div id="discoverTabSearchResults" class="tabContentContainer clearfix<%= @search_views.nil? ? '' : ' active' %>">
      <%- if (@search_views && @search_views.length > 0) -%>
        <%= render(:partial => "view_list_tab", :locals => { 
          :tab_title => "Search Results for \"#{@search_term}\"",
          :views => @search_views, :views_total => @search_views_total,
          :current_page => 1, :type => "SEARCH", :current_filter => nil, 
          :sort_by => nil, :tag_list => nil, :current_tag => nil,
          :search_term => @search_term, :search_debug => @search_debug } ) %>
      <%- else -%>
        <%= render(:partial => "view_list_tab_noresult", :locals => { :term => @search_term }) %>
      <%- end -%>
    </div>
    <div id="discoverTabPopular" class="tabContentContainer clearfix<%= @search_views.nil? ? ' active' : '' %>">
	  <% prerendered_cache "discover-tab-popular#{@agency_mcache_key}", @popular_views_rendered, :expires_in => 15.minutes do %>
		<%= render(:partial => "view_list_tab", :locals => {
		  :tab_title => t(:discover_popular_content_header),
		  :views => @popular_views, :views_total => @popular_views_total,
		  :current_page => 1, :type => "POPULAR", :current_filter => nil,
		  :sort_by => "POPULAR", :tag_list => @popular_views_tags, :current_tag => nil,
                  :search_term => nil, :search_debug => nil }) %>
	  <% end %>
    </div>
    <div id="discoverTabAll" class="tabContentContainer clearfix">
	  <% prerendered_cache "discover-tab-all#{@agency_mcache_key}", @all_views_rendered, :expires_in => 15.minutes do %>
		<%= render(:partial => "view_list_tab", :locals => {
		  :tab_title => "All #{t(:blists_name)}",
		  :views => @all_views, :views_total => @all_views_total,
		  :current_page => 1, :type => "ALL", :current_filter => nil,
		  :sort_by => "LAST_CHANGED", :tag_list => @all_views_tags, :current_tag => nil,
                  :search_term => nil, :search_debug => nil }) %>
      <% end %>
    </div>
  </div>
</div>

<% content_for :js_footer do %>
  <div class="jqmWindow" id="tagCloud"></div>
  <div class="jqmWindow" id="redirectedModal"></div>
  <div class="jqmWindow" id="splashModal"></div>
  <%= render(:partial => "shared/common_js") %>
  <%= javascript_include_merged 'data-show' %>
  <script type="text/javascript" charset="utf-8">
    discoverNS.filterUrl = "<%= data_filter_path %>";
  </script>
<% end %>
