<tbody>
  <%- start_index = (opts[:page].to_i - 1) * opts[:limit].to_i + 1 -%>
  <%- opts[:view_results].each_with_index do |v, i| -%>
    <tr itemscope="itemscope" itemtype="http://schema.org/Dataset" class="item collapsed <%= !v.federated? ? v.domainCName.gsub(/\./, "_") : "" %><%= v.federated? ? " federated" : " local" %>" data-view-id="<%= v.id %>">

      <%- if opts[:grid_items][:index] -%>
        <th class="index row-header" scope="row">
          <a class="expander" title="<%= t('controls.browse.actions.expand_section') %>" href="#Expand">
            <span class="icon"></span>
          </a>
          <span class="value"><%= start_index + i %>.</span>
        </th>
      <%- end -%>
      <%- rel_type = view_rel_type(v, CurrentDomain, opts) -%>
      <%- if opts[:grid_items][:domainIcon] -%>
          <td class="domainIcon">
              <%- if v.federated? -%>
                  <a itemprop="url" href="<%= v.link %>" rel="<%= rel_type %>">
                      <img src="<%= v.domain_icon_href %>" alt="<%= view_img_alt(v, CurrentDomain.cname) %>" />
                  </a>
              <%- end -%>
          </td>
      <%- end -%>
      <%- if opts[:grid_items][:nameDesc] -%>
        <td class="nameDesc">
          <div class="titleLine">
            <span class="hide" itemprop="name"><%= v.name %></span>
            <a itemprop="url" href="<%= v.link %>" class="name"
              rel="<%= rel_type %>"><%= v.name %></a>
            <%= render :partial => 'datasets/browse_provenance', :locals => { :v => v } %>
            <%- v.categories.each do |cat| -%>
              <span class="category infoItem"><%= cat %></span>
            <%- end -%>
            <%- if v.tags.present? -%>
              <span class="tags infoItem" itemprop="keywords"><%= join_and_truncate_array(v.tags) %></span>
            <%- end -%>
            <% if v.federated? %>
              <div class="federation-source infoItem">
                <%= t('controls.browse.listing.federation_source_html',
                      :source_link => link_to(v.domainCName, "//#{v.domainCName}")) %>
              </div>
            <% end %>
          </div>

          <div class="expandBlock clearfix collapsed">
            <div class="description"><%= view_format_description_text(v.description) %></div>
            <div class="extraInfo <%= opts[:use_federations] ? 'federated' : '' %>">
              <div class="infoContent"></div>
              <a class="close" href="#Close"><span class="icon"></span></a>
            </div>
          </div>
        </td>
      <%- end -%>

      <%- if opts[:grid_items][:largeImage] -%>
        <td class="largeImage">
          <div class="datasetIcon type type<%= v.display_class %>" title="<%= v.display_title %>">
            <span class="<%= v.icon_class %>"></span>
          </div>
        </td>
      <%- end -%>

      <%- if opts[:grid_items][:richSection] -%>
        <td class="richSection">
          <a itemprop="url" href="<%= v.link %>" class="nameLink" rel="<%= rel_type %>">
            <%- if opts[:use_federations] && v.federated? -%>
              <img class="domainIcon" src="<%= v.domain_icon_href %>" alt="<%= view_img_alt(v, CurrentDomain.cname) %>" />
            <%- end -%>
            <span itemprop="name" class="name"><%= v.name %></span>
          </a>
          <% if v.federated? %>
            <div class="federation-source">
              <%= t('controls.browse.listing.federation_source_html',
                    :source_link => link_to(v.domainCName, "//#{v.domainCName}")) %>
            </div>
          <% end %>
          <div class="expandBlock">
            <div class="description collapsed"><%= view_format_description_text(v.description) %></div>
            <a class="expander" title="<%= t('controls.browse.actions.expand_section') %>" href="#Expand">
              <span class="icon"></span>
            </a>
          </div>
        </td>
      <%- end -%>

      <%- if opts[:grid_items][:type] -%>
        <td class="type type<%= v.display_class %>" title="<%= v.display_title %>">
          <a href="<%= v.link %>" rel="<%= rel_type %>"><div class="<%= v.icon_class %>"></div></a>
        </td>
      <%- end -%>
    </tr>
  <%- end -%>
</tbody>
