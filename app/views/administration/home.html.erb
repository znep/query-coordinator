<% content_for :head do %>
  <%= rendered_stylesheet_tag 'administration-screen' %>
  <%= rendered_stylesheet_tag 'administration-home' %>
  <title>Manage Home Page | <%= CurrentDomain.strings.site_title %></title>
<% end %>

<% content_for :skip_links do %>
  <a href="?no_js=true">Disable Javascript on this page</a>
<% end %>

<%= render :partial => 'left_nav' %>

<div class="contentBox withLeftNavigation homeManagement">
  <div class="adminHeader homemgmt">
    <span class="icon"></span>
    <h1>Manage Home Page</h1>
  </div>
</div>

<%- if CurrentDomain.user_can?(current_user, 'manage_stories') -%>
<div class="contentBox withLeftNavigation">
  <a href="home/story/new" class="button newButton newStoryButton rightArrow">Create a New Story<span class="icon"></span></a>
  <h2>Manage Story Content</h2>

  <div class="gridListWrapper">
    <table class="gridList storiesList" cellspacing="0">
      <colgroup>
        <col class='image' />
        <col class='contents' />
        <col class='date' />
        <col class='actions' />
      </colgroup>
      <thead>
        <tr>
          <th class="image"><div>Image</div></th>
          <th class="contents"><div>Contents</div><span class="icon"></span></th>
          <th class="date"><div>Date Published</div><span class="icon"></span></th>
          <th class="actions"><div></div></th>
        </tr>
      </thead>
      <tbody>
        <%- @stories.sort{ |a, b| a.createdAt <=> b.createdAt }.each do |story| -%>
          <tr>
            <td class="image">
              <div class="imagePreview"><div class="imagePreviewWrapper">
                <img src="/assets/<%= story.imageId %>" alt="<%= story.headline %>"/>
              </div></div>
            </td>
            <td class="contents">
              <div class="storyTitle"><span class="cellInner"><%= raw story.headline %></span></div>
              <p class="storyBody"><%= raw story.story %></p>
            </td>
            <td class="date"><span class="cellInner"><%= Time.at(story.createdAt).strftime('%Y/%m/%d %I:%M%p') %></span></td>
            <td class="actions">
              <span class="loading"></span>
              <a href="home/story/<%= story.id %>" class="editStoryButton button">
                <span class="icon"></span>Edit
              </a>
              <a href="home/story/<%= story.id %>/delete" class="deleteStoryButton button">
                <span class="icon"></span>Delete
              </a>
            </td>
          </tr>
        <%- end -%>
      </tbody>
    </table>
  </div>
</div>

<div class="contentBox withLeftNavigation">
  <a href="home/stories/appearance" class="button newButton storyAppearanceButton rightArrow">Customize Now<span class="icon"></span></a>
  <h2>Customize Story Appearance</h2>
</div>
<%- end -%>

<%- if CurrentDomain.user_can?(current_user, 'feature_items') -%>
  <!-- <h2>Manage Featured Datasets</h2> -->
<%- end -%>

<%- content_for :js_footer do -%>
  <%- unless params[:no_js].present? -%>
    <%= javascript_include_merged 'admin-home' %>
  <%- end -%>
<%- end -%>
