def npm(path, command)
  command = "cd #{path} && npm #{command}"
  if block_given?
    sh(command) { |ok, res| yield(ok, res) }
  else
    sh(command)
  end
end

def rspec(path)
  sh("cd #{path} && rspec")
end

def guard(path)
  sh("cd #{path} && guard")
end

Dir.glob('tasks/*.rake').each { |file| load(file) }
# Load tasks from site_chrome.
Dir.glob('site_chrome/lib/tasks/*.rake').each { |file| load(file) }

desc 'Run linter'
task lint: :deps do
  npm('karma_config', 'run lint')
  npm('site_chrome', 'run lint')
end

task :deps do
  Rake.application['karma:deps'].invoke
  Rake.application['rspec:deps'].invoke
end

desc 'Run lint and tests'
task default: %w[lint test]

desc 'Run all tests'
task test: [:karma, :rspec]
