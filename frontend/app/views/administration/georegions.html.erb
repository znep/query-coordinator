<%- prefix = 'screens.admin.georegions' %>
<%- no_js = params[:no_js].present? -%>

<% content_for :head do %>
  <%= rendered_stylesheet_tag 'administration-screen' %>
  <%= rendered_stylesheet_tag 'administration-georegions' %>
  <title><%= t("#{prefix}.title") %> | <%= @view_model.site_title %></title>
<% end %>

<% content_for :skip_links do %>
  <%= link_to t('core.no_js'), '?no_js=true' %>
<% end %>

<% admin_breadcrumb("#{prefix}.page_title") %>

<%= render '/administration/left_nav' %>

<div class="contentBox <%= admin_page_with_left_nav_class %> georegionsScreen">
  <div id="flash-container"><%= display_standard_flashes %></div>
  <div class="adminHeader floating georegions">
    <span class="icon"></span>

    <h1><%= t("#{prefix}.page_title") %></h1>
    <h4 id="georegions-page-subtitle"><span><%= t("#{prefix}.page_subtitle", :default_count => @view_model.default_count, :available_count => @view_model.maximum_default_count) %></span></h4>
    <h4 id="georegions-learn-more"><span class="icon-info"></span> <span><%= raw(t("#{prefix}.learn_more")) %></span></h4>
  </div>
</div>


<div class="contentBox <%= admin_page_with_left_nav_class %> georegionsScreen">
  <div class="georegions-custom">
    <div class="clearfix">
      <h1 class="georegions-title-custom"><%= t("#{prefix}.custom_georegions") %></h1>

      <div class="georegions-controls-custom">
        <%= form_button(
          { :action => 'add_georegion' },
          t("#{prefix}.create_new"),
          { :method => :post },
          { :class => 'button', 'data-action' => 'add' }) %>
      </div>
    </div>

    <%= render :partial => 'georegions_table', :locals => {
        :allow_defaulting => @view_model.allow_defaulting?,
        :count => @view_model.default_count,
        :failed_jobs => @view_model.failed_curated_region_jobs,
        :georegions => @view_model.curated_regions,
        :jobs => @view_model.curated_region_jobs,
        :limit => @view_model.maximum_default_count,
        :prefix => prefix,
        :render_actions => @view_model.curated_regions.any?
      } %>
  </div>
</div>

<%= render_admin_qualtrics %>

<%- content_for :modals do -%>
  <%= render :partial => 'modals/select_georegion', :locals => { :title => t("#{prefix}.choose_a_dataset") } %>
  <div class="modalDialog" id="react-modal"></div>
<%- end -%>

<% content_for :js_footer do %>
  <%- unless params[:no_js] == 'true' -%>

    <script type="text/javascript" id="bar">
      (function(georegionsNS) {
        georegionsNS.georegions = <%== @view_model.curated_regions.to_json %>;
        georegionsNS.jobs = <%== @view_model.curated_region_jobs.to_json %>;
        georegionsNS.failedJobs = <%== @view_model.failed_curated_region_jobs.to_json %>;

        georegionsNS.maximumDefaultCount = <%==
          @view_model.maximum_default_count.to_json
        %>;

        georegionsNS.flash = <%==
          flash.map do |type, message|
            { :type => type, :message => message }
          end.to_json
        %>;
      })(
        blist.namespace.fetch('blist.georegions')
      );
    </script>

    <%= include_webpack_bundle 'admin/admin-georegions-screen.js' %>
  <%- end -%>
<% end %>
<%= render_translations @view_model.translations %>
