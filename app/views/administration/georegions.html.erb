<%- prefix = 'screens.admin.georegions' %>
<%- no_js = params[:no_js].present? -%>

<% content_for :head do %>
  <%= rendered_stylesheet_tag 'administration-screen' %>
  <%= rendered_stylesheet_tag 'administration-georegions' %>
  <title><%= t("#{prefix}.title") %>
    | <%= current_domain.strings.site_title %></title>
<% end %>

<% content_for :skip_links do %>
  <%= link_to t('core.no_js'), '?no_js=true' %>
<% end %>

<%= render :partial => 'left_nav' %>

<div class="contentBox withLeftNavigation georegionsScreen">
  <div class="adminHeader floating georegions">
    <span class="icon"></span>

    <h1><%= t("#{prefix}.page_title") %></h1>
    <h4 id="georegions-page-subtitle"><span><%= t("#{prefix}.page_subtitle", :enabled_count => @view_model.enabled_count, :available_count => @view_model.maximum_enabled_count) %></span></h4>
  </div>
</div>


<div class="contentBox withLeftNavigation georegionsScreen">
  <div class="georegions-custom">
    <div class="clearfix">
      <h1 class="georegions-title-custom"><%= t("#{prefix}.custom_georegions") %></h1>

      <div class="georegions-controls-custom">
        <%= form_button(
          { :action => 'add_georegion' },
          t("#{prefix}.add_new"),
          { :method => :post },
          { :class => 'button', 'data-action' => 'add' }) %>
      </div>
    </div>

    <%= render :partial => 'georegions_table', :locals => { :prefix => prefix, :georegions => @view_model.custom_regions, :allow_actions => true } %>
  </div>
</div>

<div class="contentBox withLeftNavigation georegionsScreen">
  <div class="georegions-default">
    <div>
      <h1><%= t("#{prefix}.default_georegions") %></h1>
    </div>

    <%= render :partial => 'georegions_table', :locals => { :prefix => prefix, :georegions => @view_model.default_regions, :allow_actions => false } %>
  </div>
</div>

<%- content_for :templates do -%>
  <div class="georegions-table">
    <table>
      <tbody class="georegions-tbody">
      <tr class="item">
        <td class="name"></td>
        <td class="toggle-enabled">
          <span class="enabled-state">&nbsp;</span>
          <form class="toggle-enabled-form" accept-charset="UTF-8" action="" method="post">
            <div style="margin:0;padding:0;display:inline">
              <input name="utf8" type="hidden" value="✓">
              <input name="_method" type="hidden" value="put">
              <input name="authenticity_token" type="hidden" value="">
            </div>
            <input class="button toggle-enabled-button" name="commit" type="submit" value="">
          </form>
        </td>
        <td class="edit-action">
          <form class="edit-action-form" accept-charset="UTF-8" action="" method="post">
            <div style="margin:0;padding:0;display:inline">
              <input name="utf8" type="hidden" value="✓">
              <input name="_method" type="hidden" value="put">
              <input name="authenticity_token" type="hidden" value="">
            </div>
            <input class="button" name="commit" type="submit" value="<%= t("#{prefix}.edit") %>">
          </form>
        </td>
        <td class="remove-action">
          <form class="remove-action-form" accept-charset="UTF-8" action="" method="post">
            <div style="margin:0;padding:0;display:inline">
              <input name="utf8" type="hidden" value="✓">
              <input name="_method" type="hidden" value="put">
              <input name="authenticity_token" type="hidden" value="">
            </div>
            <input class="button" name="commit" type="submit" value="<%= t("#{prefix}.remove") %>">
          </form>
        </td>
      </tr>
      </tbody>
    </table>
  </div>
<%- end -%>

<%- content_for :modals do -%>
  <%= render :partial => 'modals/select_georegion', :locals => { :title => t("#{prefix}.choose_a_dataset") } %>
<%- end -%>

<% content_for :js_footer do %>
  <%- unless params[:no_js] == 'true' -%>
    <%= include_javascripts 'admin-georegions' %>
    <script type="text/javascript">
      blist.namespace.fetch('blist.georegions').georegions = <%== @view_model.curated_regions.to_json %>;
    </script>
  <%- end -%>
<% end %>
<%= render_translations @view_model.translations %>
