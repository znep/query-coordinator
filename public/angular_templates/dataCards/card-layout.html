<div class="card-spot"
     animate-to="cardPosition.style"
     animate-to-index="{{ cardPosition.index }}"
     ng-repeat="cardPosition in cardPositions track by cardPosition.model.uniqueId">
  <card model="cardPosition.model"
        class="card"
        where-clause="globalWhereClauseFragment"
        interactive="true"
        ng-class="{ expanded: cardPosition.model.getCurrentValue('expanded'), dragged: cardPosition.model === grabbedCard.model }"></card>
  <div class="card-drop-placeholder"
    ng-if="cardPosition.model === grabbedCard.model && cardPosition.model.fieldName !== '*'"
    ></div>
  <div class="card-drag-overlay"
    data-card-id="{{cardPosition.model.uniqueId}}"
    ng-if="editMode && cardPosition.model !== grabbedCard.model && cardPosition.model.fieldName !== '*'">
    <div class="card-controls">
      <div class="card-control icon-settings"
           ng-class="{disabled: !isCustomizable(cardPosition.model)}"
           ng-click="customizeCard(cardPosition.model)"
           title="{{ isCustomizable(cardPosition.model) ? 'Customize this card' : 'There are no customization options for this card yet' }}"></div>
      <div class="card-control icon-close"
           title="Remove this card"
           ng-click="deleteCard(cardPosition.model)"></div>
    </div>
  </div>
</div>

<div ng-repeat="placeholder in placeholderDropTargets"
  ng-style="placeholder.style"
  class="card-group-drop-placeholder"
  data-group-id="{{ placeholder.cardSize}}"></div>
<button
  ng-repeat="button in addCardButtons"
  ng-style="button.style"
  type="button"
  class="add-card-button action-btn dark l-to-r"
  ng-class="{disabled: !allowAddCard}"
  ng-show="editMode"
  ng-click="addCard(button.cardSize)">Add card here</button>

<modal-dialog
  ng-if="addCardState.show"
  dialog-state="addCardState"
  >
  <add-card-dialog
    card-models="cardModels"
    card-size="cardSize"
    on-customize-card="customizeCard"
    dataset-columns="datasetColumns"
    dialog-state="addCardState"
    page="page"
    ></add-card-dialog>
</modal-dialog>

<modal-dialog
  class="second"
  ng-if="customizeState.show"
  dialog-state="customizeState">
  <customize-card-dialog
    card-model="cardModel"
    card-models="cardModels"
    dialog-state="customizeState"
    page="page"
  />
</modal-dialog>
