<%- if tab_to_render == :search -%>
  <%- if (@search_views && @search_views.length > 0) -%>
    <%= render(:partial => "view_list_tab", :locals => {
      :tab_title => "Search Results for \"#{@search_term}\"",
      :views => @search_views, :views_total => @search_views_total,
      :current_page => @current_state['page'], :type => "search", :current_filter => params[:filter],
      :sort_by => nil, :tag_list => nil, :current_tag => nil,
      :port => @current_state['port'],
      :search_term => @search_term, :page_size => @page_size } ) %>
  <%- else -%>
    <%= render(:partial => "view_list_tab_noresult", :locals => { :term => @search_term }) %>
  <%- end -%>

<%- elsif tab_to_render == :popular -%>
  <%- mod_state = @current_state.merge(
    {'type' => 'popular', 'domain' => CurrentDomain.cname,
      'sort_by' => @current_state['sort_by'] || 'POPULARITY'}) -%>
  <% prerendered_cache cache_key('discover-tab', mod_state),
    @popular_views_rendered, :expires_in => 15.minutes do %>
    <%= render(:partial => "view_list_tab", :locals => {
      :tab_title => 'Popular',
      :views => @popular_views || @filtered_views,
      :views_total => @popular_views_total || @filtered_views_total,
      :current_page => @current_state['page'], :type => "popular",
      :current_filter => @current_state['filter'],
      :sort_by => @current_state['sort_by'] || 'POPULARITY',
      :tag_list => @popular_views_tags || @filtered_views_tags,
      :current_tag => @current_state['tag'], :search_term => nil,
      :port => port,
      :page_size => @page_size }) %>
  <% end %>

<%- elsif tab_to_render == :all -%>
  <%- mod_state = @current_state.merge(
    {'type' => 'all', 'domain' => CurrentDomain.cname,
    'sort_by' => @current_state['sort_by'] || 'LAST_CHANGED'}) -%>
  <% prerendered_cache cache_key('discover-tab', mod_state),
    @all_views_rendered, :expires_in => 15.minutes do %>
      <%= render(:partial => "view_list_tab", :locals => {
        :tab_title => 'All',
        :views => @all_views || @filtered_views,
        :views_total => @all_views_total || @filtered_views_total,
        :current_page => @current_state['page'], :type => "all",
        :current_filter => @current_state['filter'],
        :sort_by => @current_state['sort_by'] || 'LAST_CHANGED',
        :tag_list => @all_views_tags || @filtered_views_tags,
        :current_tag => @current_state['tag'], :search_term => nil,
        :port => port,
        :page_size => @page_size }) %>
    <% end %>

<%- end -%>