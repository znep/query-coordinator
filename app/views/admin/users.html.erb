<% content_for :head do %>
<%= stylesheet_link_merged 'admin-shared' %>
<title>Administration Panel | <%= CurrentDomain.strings.site_title %></title>
<% end %>
<%- users_list = nil -%>

<div id="publishContent" class="oneColumnContainer tabContainer">
  <%= render :partial => 'tabs', :locals => {:active => 'users'} %>
  <div class="fullPageContentContainer fullPageWithTabs">
    <div class="fullPageOuterContent">
      <div class="fullPageContent">
        <div class='outerContent'>
          <div class='contentTR'><div class='contentTL'></div></div>
          <div class='content' id='adminContent'>
            <%= render :partial => 'user_search', :locals => {:search_param => @search} %>

            <h1>Manage Users</h1>

            <%- if flash[:notice] -%>
              <p class='userSaved'><%= flash[:notice] %></p>
            <%- end -%>
            <div class='adminUsersTable'>
            <%- if @user_search_results.nil? -%>
              <p class='information'>To modify user privileges on this domain, search for them above or choose from the list of existing users below.</p>
              <div class='administrators'>
                <h2>Current Privileged Users</h2>
                <%- users_list = @admins -%>
            <%- elsif @user_search_results.empty?-%>  
              <p>No users found.</p>
            <%- else %>
              <div id='adminUsers'>
                <h2>Search Results for '<%= @search %>'</h2>
                <%- users_list = @user_search_results -%>
            <%- end -%>
            
            <%- unless users_list.nil? -%>
              <%- users_list.each do |user| -%>
              <span class='userRow <%= cycle('even', 'odd') %>'>
                <span class='userIdCell'><%= user.displayName %></span>
                <span class='userRolesCell'>
                <form class='userSelectForm' method='post' action='/admin/save_user/<%= user.id %>'>
                <%= raw(select_for_role("userSelect-#{user.id}", 'role', user.roleName, 'roleSelect')) %>
                <input type='hidden' name='userid' class='hiddenID' value='<%= user.id %>' />
                <input type='hidden' name='authenticity_token' value='<%= form_authenticity_token %>' />
                <input type='submit' class='userSaveButton' value='Save' />
                <span class='statusMessage'></span>
                <span class='errorMessage'></span></form></span>
              </span>
              <%- end -%>
              </div>
            <%- end -%>

            </div>
            <div class='rolesExplanation'>
              <h2>Roles</h2>
              <ul>
              <%- @roles_list.each do |role| -%>
                <li><span class='roleTitle'><%= role[0] %></span> - <%= role[1] %>
              <%- end -%>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>


<% content_for :js_footer do %>
  <%= javascript_include_merged 'base' %>
  <%= javascript_include_merged 'shared-common-all' %>
  <%= javascript_include_merged 'admin-users' %>
<% end %>
