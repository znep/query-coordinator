<%- prefix = 'screens.stats' -%>
<% content_for :head do %>
  <%= rendered_stylesheet_tag 'dataset-analytics' %>
  <%= rendered_stylesheet_tag 'analytics-shared' %>
  <title><%= t("#{prefix}.title") %> - <%= @view.name %> | <%= get_site_title %></title>
<% end %>

<% content_for :skip_links do %>
  <%= link_to t('core.no_js'), '?no_js=true' %>
<% end %>

<div id="analyticsDataContainer" class="datasetMetrics">
  <div class="contentBox clearfix">
    <div>
      <h1><%= link_to @view.name, view_path(@view) %></h1>
      <%= render :partial => 'shared/metrics_timing' %>
    </div>

    <div class="summaryDisplay clearfix container"></div>
<%- unless FeatureFlags.derive(@view, request).embetter_analytics_page -%>
  </div>
  <div class="contentBox clearfix">
<%- end -%>
    <div class="chartsDisplay container">
      <div class="flash error message errorMessage">
        <h3><%= t("#{prefix}.error_loading") %></h3>
      </div>
    </div>
    <div class="detailDisplay clearfix container"></div>
<%- unless FeatureFlags.derive(@view, request).embetter_analytics_page -%>
  </div>
  <div class="contentBox clearfix">
<%- end -%>
    <div class="topDisplay clearfix container">
      <div class="leftColumn"></div>
      <div class="rightColumn"></div>
    </div>
  </div>
</div>

<div class="clearfix"></div>

<% content_for :templates do %>
  <%= render :partial => 'shared/metrics_sections' %>
  <%= render :partial => 'shared/control_templates' %>
<%- end -%>

<% content_for :js_footer do %>
  <%- unless params[:no_js] == 'true' -%>
    <script type="text/javascript">
      blist.configuration.govStatMetricsEnabled = <%= module_enabled?(:govStat) == true %>;
      blist.namespace.fetch('blist.metrics');
      blist.metrics.viewID = '<%= @view.id %>';
      <%= raw @view.display.render_inline_setup_js('renderTypeContainer', self) %>
    </script>
    <%= include_webpack_bundle 'open-data/sanitize-html.js' %>
    <%= include_webpack_bundle 'open-data/shared-metrics.js' %>
    <%= include_webpack_bundle 'open-data/dataset-metrics.js' %>
  <%- end -%>
<% end %>
<%= render_translations LocalePart.screens.stats %>
<%= render_translations LocalePart.plugins.daterangepicker %>
