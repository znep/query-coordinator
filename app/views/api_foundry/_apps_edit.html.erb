<%- throttles = @view.find_api_throttles() -%>
<% content_for :nav_crumb do %>
  <li>
    <a href="<%= @nav_root + "/apps" %>" >Applications Request Limits</a>
    <%- if throttles.length > 0 %>
      <ul>
        <% throttles.each do |throttle| %>
          <li><a href="<%= @nav_root + "/apps/" + throttle.appToken %>"><%= throttle.appName %></a></li>
        <% end %>
      </ul>
    <%- end %>
  </li>
  <li>
    <%= params[:token] == "new" ? "Add " : "Edit " %>Request Limit
  </li>
<% end %>

<%- 
  if params[:token] == "anonymous"
    throttle = @view.find_api_anonymous_throttle()
  else
    throttle = throttles.detect{|t| t.appToken == params[:token] }
  end
-%>

<a name="apps"></a>
<div id="applications" class="managesection">
  <div class="flash appFlash"></div>
  <div id="tableWrapper">
    <form method="get" action="setThrottle">
      <table class="throttleTable" cellspacing="0">
        <tr>
          <th colspan="2" class="left title">
            Edit Application Request Limits
          </th>
          <th colspan="3"><div class="bg">Request Limits</div></th>
        </tr>
        <tr>
          <th class="left">Application</th>
          <th>Token</th>
          <th><div class="bg">/Minute</div></th>
          <th><div class="bg">/Hour</div></th>
          <th><div class="bg">/Day</div></th>
          <th></th>
        </tr>
        <tr class="throttleEdit">
          <% if params[:token] == "anonymous" %>
            <td class="left">
              <span class="apiicon ico-applications"> </span>
              Anonymous Applications
            </td>
            <td><input name="appToken" disabled="disabled" value="<none>" ></input></td>
          <% elsif !throttle.nil? %>
            <td class="left">
              <span class="apiicon ico-applications"> </span>
              <span>
                <p class="appName"><%= throttle.appName %></p>
                <p class="appDesc"><%= throttle.appDesc %></p>
              </span>
              <input name="appToken" type="hidden" value="<%= throttle.appToken %>"></input>
            </td>
            <td><input disabled="disabled" value="<%= throttle.appToken %>" >    </input></td>
          <% else %>
            <td class="left">
              <span class="apiicon ico-applications"> </span>
            </td>
            <td><input name="appToken" value="" ></input></td>
          <% end %>
          <td><input name="minuteLimit" class="limitEdit hunum" value="<%= throttle.nil? ? "" : throttle.minuteLimit  %>" > </input></td>
          <td><input name="hourLimit"   class="limitEdit hunum" value="<%= throttle.nil? ? "" : throttle.hourLimit  %>" >   </input></td>
          <td><input name="dayLimit"    class="limitEdit hunum" value="<%= throttle.nil? ? "" : throttle.dayLimit  %>" >    </input></td>
        </tr>
        <tr>
          <td colspan="5" class="left">
            <% if !throttle.nil? %>
              <a id="<%= throttle.appToken %>" class="button limitRemoveButton default" href="#">Remove Limits</a>
            <% end %>
            <input id="limitUpdate" type="submit" value="<%= params[:token] == "new" ? "Add Limits" : "Update Limits" %>" class="button" ></input>
          </td>
        </tr>
      </table>
    </form>
  </div>
</div>
