<%- content_for(:wrapper_class, "narrowDialog") -%>
<%- content_for :headline do -%>
<h1 class='formIcon'>Create a Form View</h1>
<%- end -%>

<div class='modalContentWrapper formWrapper viewSetupWrapper'>
  <p class='subtitle'>
  Forms allow you to gather data directly from your website into a datset
  </p>

  <% form_tag("#{@view.href}/create_form") do %>
    <div class='section'>
      <h3>Name</h3>
      <p class='subtitle separator'>
      Give a name to your new form view
      </p>
      <div class='line'>
        <label class='required' for='formName'>Name</label>
        <input type='text' id='formName' name='viewName' class='required' />
      </div>
    </div>

    <%#
    <div class='section'>
      <h3>
        Permissions
      </h3>
      <p class='subtitle separator'>
      (fill in)
      </p>
      <div class='line'>
        <label class='required' for='TODO'>(label)</label>
        <input />
      </div>
    </div>
    %>

  <%- end -%>

  <div class='error mainError'></div>

  <div class='submitLine clearfix'>
    <div class="required">Required Field</div>
    <ul class='actionButtons clearfix'>
      <li><a href='#create' class='create arrowButton'>Create Form</a></li>
    </ul>
  </div>
</div>

<script type="text/javascript" charset="utf-8">
  blist.common.modalReady = function()
  {
    $('.formWrapper form').validate({errorElement: 'span'});

    var formSubmit = function(event)
    {
      event.preventDefault();
      $('.formWrapper .mainError').text('');
      var $form = $('.formWrapper form');
      if (!$form.valid()) { return; }

      $.ajax({
          url: $form.attr("action"),
          type: "POST",
          data: $form.serialize(),
          dataType: "json",
          success: function(data)
          {
            if (data.status == 'failure')
            {
              $('.formWrapper .mainError').text(data.errors.join('; '));
            }
            else
            {
              $("#modal").jqmHide();
              blist.util.navigation.redirectToView(data.newViewId);
            }
          }
      });
    };

    $('.formWrapper form').submit(formSubmit);
    $('.formWrapper a.create').click(formSubmit);
  };
</script>
