<% content_for :head do %>
  <%= rendered_stylesheet_tag 'screen-login' %>

  <title><%= CurrentDomain.strings.site_title %></title>
<% end %>

<% content_for :skip_links do %>
  <%- unless params[:no_js].present? -%>
    <%= link_to 'Disable Javascript on this page', '?no_js=true' %>
  <%- end -%>
<% end %>

<%- openid_login = CurrentDomain.module_available?(:openid_login) -%>

<div class="modalContentBox siteContent<%= ' wide' if openid_login %>">
  <div class="contentHeader">
    <h1>We're glad you want to join <%= CurrentDomain.strings.company %>!</h1>
  </div>
  <div class='contentBoxInner clearfix'>
    <div class="loginSignupForm firstColumn column" id="signup">

      <div class="authProvider socrata">
        <span class="iconContainer"> <span class="icon"></span> </span>
        <span class="description">
          Create a new <strong><%= MASTER_DOMAIN_PREFS['strings.company'] %> ID</strong>
        </span>
        <p class="loginTips">
          <%= raw MASTER_DOMAIN_PREFS['strings.login_tips'] %>
        </p>
      </div>

      <%- if !CurrentDomain.strings.disclaimer.nil? -%>
        <p class="signupDisclaimer"><%= raw CurrentDomain.strings.disclaimer %></p>
      <%- end -%>

      <% form_for :signup, @signup, :url => account_path,
        :html => {:id => 'signupForm', :multipart => true} do |f| %>
        <%= display_standard_flashes %>
        <%= f.hidden_field :inviteToken %>
        <%= f.hidden_field :openIdIdentifierId %>
        <%= f.hidden_field :firstName %>
        <%= f.hidden_field :lastName %>
        <%# TODO: Remove me when v3 is deprecated %>
        <%= hidden_field_tag 'signup[accept_terms]', 'true' %>

        <div class="line">
          <div class="labelLine">
            <%= f.label :email, 'Email Address', :class => 'main' %>
          </div>
          <%= f.text_field :email %>
        </div>

        <div class="line">
          <div class="labelLine">
            <%= f.label :screenName, 'Display Name', :class => 'main' %>
          </div>
          <%= f.text_field :screenName, :maxlength => 40 %>
        </div>

        <div class="line">
          <div class="labelLine">
            <%= f.label :password, 'Password', :class => 'passwordLabel main' %>
            <span class="passwordHint">(6 characters or more)</span>
          </div>
          <%= f.password_field :password %>
        </div>

        <div class="line">
          <div class="labelLine">
            <%= label_tag :passwordConfirm, 'Confirm Password', :class => 'main' %>
          </div>
          <%= f.password_field :passwordConfirm %>
        </div>

        <p class="signUpHint">
          <%= raw MASTER_DOMAIN_PREFS['strings.signup_terms'] %>
        </p>

        <div class="formActionButtons">
          <input type="submit" class="button default" value="Create My Account" />
        </div>
      <% end %>

    </div>

    <%- if openid_login -%>
      <div class="rpxLoginPane column">
        <%= render :partial => 'rpx/openid_login', :locals => {:auth_action => 'join'} %> 
      </div>
    <%- end -%>
  </div>
</div>

<% content_for :js_footer do %>
  <%= javascript_include_merged 'shared-common-all' %>
  <%= javascript_include_tag 'screens/signup-screen' %>
  <%= javascript_include_tag 'https://rpxnow.com/openid/v2/widget' %>

  <script type="text/javascript">
    RPXNOW.overlay = true;
    RPXNOW.language_preference = 'en';
    RPXNOW.flags='show_provider_list';
  </script>

<% end %>
