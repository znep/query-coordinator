<% content_for :head do %>
  <%= auto_discovery_link_tag(:rss, "/views/#{@view.id}/rows.rss") %>
  <%= raw @view.display.render_stylesheet_includes %>
  <%= rendered_stylesheet_tag 'dataset-page' %>

  <title><%= h(@view.name) %> | <%= CurrentDomain.strings.site_title %></title>
  <%= meta_tags :description => @meta_description, :keywords => @meta_keywords %>
  <link rel="canonical" href="<%= @view.href %>" />
<% end %>

<div id='datasetBar' class='clearfix'>
  <div id='viewsMenu' class='menu'></div>
  <div id='datasetIcon' class='type<%= @view.display.type %>'>
    <span class='icon'><%= @view.display.name %></span>
  </div>

  <div id='titleLine'>
    <span id='datasetName'><%= @view.name %></span>
  </div>

  <div id='actionLine' class='clearfix'>
    <span id='description' class='clipText'><%= @view.description %></span>

    <ul id='sidebarOptions' class='right'>
      <li><a href='#Feed'>Feed</a></li>
      <li><a href='#Filter'>Filter</a></li>
      <li><a href='#Visualize' data-paneName='visualize'>Visualize</a></li>
      <li><a href='#Embed' data-paneName='embed'>Embed</a></li>
    </ul>
    <ul class='right'>
      <li><a id='searchLink' class='search' href='#Search'>
        <span class='icon'></span>Search
      </a></li>
      <li><div id='shareMenu' class='share menu'></div></li>
    </ul>
  </div>
</div>

<div class='outerContainer'>
  <div id='mainGrid'>
    <%= raw @view.display.render_body(self) %>
    <%= render(:partial => @view.display.render_partial) %>
  </div>

  <div id='gridSidebar'>
    <a class='close' href='#close'><span class='icon'>Close</span></a>
  </div>
</div>

<% content_for :templates do %>
<%= render(:partial => 'grid_sidebar_templates') %>
<% end %>

<% content_for :js_footer do %>
  <%- if !current_user -%>
  <%= render :partial => 'blists/login' %>
  <%= render :partial => 'blists/signup' %>
  <%- end -%>

  <script type="text/javascript">
    <%= raw @view.display.render_inline_setup_js('data-grid', self) %>

    <%- if !current_user.nil? -%>
      blist.currentUserId = '<%= current_user.id %>';
      blist.isOwner = <%= current_user.id == @view.owner.id ? 'true' : 'false' %>;
    <%- end -%>

    <%# Namespace to keep track of disabled sidebar sections %>
    blist.namespace.fetch('blist.sidebarHidden');
    <%# Calendar %>
    blist.sidebarHidden.visualize = blist.sidebarHidden.visualize || {};
    blist.sidebarHidden.visualize.calendarCreate = <%= @view.is_alt_view? %>;
    <%# Form %>
    blist.sidebarHidden.embed = blist.sidebarHidden.embed || {};
    blist.sidebarHidden.embed.formCreate = <%= @view.is_alt_view? ||
      @view.is_grouped? ||
      !CurrentDomain.user_can?(current_user, :create_datasets) ||
      !module_available?(:form_publish) ||
      !@view.owned_by?(@current_user) ||
      !@view.parent_dataset.owned_by?(@current_user) %>;
  </script>

  <%- if @view.can_edit() && !@view.is_blobby? -%>
  <%= raw @view.display.render_edit_javascript_includes(self) %>
  <%- end -%>
  <%= raw @view.display.render_javascript_includes(self) %>

  <%= javascript_include_merged 'screen-dataset' %>
<% end %>
