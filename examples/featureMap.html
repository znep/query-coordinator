<!DOCTYPE html>
<html>
  <head>
    <title>Example Usage: socrata.visualizations.FeatureMap.js</title>
    <meta http-equiv="content-type" content="text/html; charset=UTF8">
    <!-- `leaflet.css` must be included or the map will render incorrectly -->
    <link rel="stylesheet" media="all" href="../bower_components/leaflet/dist/leaflet.css">
    <link rel="stylesheet" media="all" href="../socrata.visualizations.featureMap.css">
    <style type="text/css">

      body {
        font-size: 10px;
        font-family: sans-serif;
      }

      #feature-map {
        display: block;
        position: relative;
        width: 640px;
        height: 480px;
        margin: 100px auto 0 auto;
        border: 1px solid #aaa;
      }

    </style>
  </head>
  <body>
    <div id="feature-map"></div>
  </body>
  <!-- lodash must be loaded before `socrata.utils.js` -->
  <script type="text/javascript" src="../bower_components/lodash/lodash.js"></script>
  <script type="text/javascript" src="../bower_components/socrata-utils/socrata.utils.js"></script>
  <!-- jquery must be loaded before `socrata.visualizations.Visualization.js` -->
  <script type="text/javascript" src="../bower_components/jquery/dist/jquery.js"></script>
  <!-- `socrata.visualizations.Visualization.js` must be loaded before `socrata.visualizations.FeatureMap.js` -->
  <script type="text/javascript" src="../socrata.visualizations.Visualization.js"></script>
  <!-- leaflet must be loaded before `socrata.visualizations.FeatureMap.js` -->
  <script type="text/javascript" src="../bower_components/leaflet/dist/leaflet.js"></script>
  <!-- `socrata.visualizations.pbf.js` must be loaded before `socrata.visualizations.FeatureMap.js` -->
  <script type="text/javascript" src="../socrata.visualizations.pbf.js"></script>
  <!-- vector-tile-js must be loaded before `socrata.visualizations.FeatureMap.js` -->
  <script type="text/javascript" src="../bower_components/vector-tile-js/dist/vectortile.js"></script>
  <!-- d3 must be loaded before `socrata.visualizations.FeatureMap.js` -->
  <script type="text/javascript" src="../bower_components/d3/d3.js"></script>
  <!-- `socrata.visualizations.VectorTileManager.js` must be loaded before `socrata.visualizations.FeatureMap.js` -->
  <script type="text/javascript" src="../socrata.visualizations.VectorTileManager.js"></script>
  <script type="text/javascript" src="../socrata.visualizations.FeatureMap.js"></script>
  <!-- `socrata.visualizations.DataProvider.js` must be loaded before `socrata.visualizations.SocrataTileserverDataProvider.js` -->
  <script type="text/javascript" src="../socrata.visualizations.DataProvider.js"></script>
  <script type="text/javascript" src="../socrata.visualizations.GeospaceDataProvider.js"></script>
  <script type="text/javascript" src="../socrata.visualizations.TileserverDataProvider.js"></script>
  <script type="text/javascript" src="../socrata.visualizations.SoqlDataProvider.js"></script>
  <script type="text/javascript" src="../socrata.visualizations.MetadataProvider.js"></script>
  <script type="text/javascript" src="../components/SocrataFeatureMap.js"></script>
  <script type="text/javascript">

    var APP_TOKEN = 'zvQamMSTi4GNuZWWDwjLdLPhW';
    var DOMAIN = 'dataspace.demo.socrata.com';
    var FOUR_BY_FOUR = 'r6t9-rak2';
    var FIELD_NAME = 'point';

    var $featureMapElement = $('#feature-map');

    var featureMapConfig = {
      // Data
      appToken: APP_TOKEN,
      domain: DOMAIN,
      fourByFour: FOUR_BY_FOUR,
      fieldName: FIELD_NAME,
      // Behavior
      hover: true,
      disablePanAndZoom: false,
      // The localization values should be set by the application but are set to string literals
      // for the purposes of this example.
      localization: {
        'FLYOUT_FILTER_NOTICE': 'There are too many points at this location',
        'FLYOUT_FILTER_OR_ZOOM_NOTICE': 'Zoom in to see details',
        'FLYOUT_DENSE_DATA_TITLE': 'Numerous',
        'FLYOUT_CLICK_TO_INSPECT_NOTICE': 'Click to see details',
        'ROW_INSPECTOR_ROW_DATA_QUERY_FAILED': 'Detailed information about these points cannot be loaded at this time.'
      },
      // Base layer
      baseLayer: 'https://a.tiles.mapbox.com/v3/socrata-apps.ibp0l899/{z}/{x}/{y}.png',
      baseWhereClause: '',
      useOriginHost: false
    };

    $featureMapElement.socrataFeatureMap(featureMapConfig);

    $featureMapElement.on('SOCRATA_VISUALIZATION_FEATURE_MAP_FLYOUT', function(event) {

      var payload = event.originalEvent.detail.data;

      // Render/hide a flyout
    });

    $featureMapElement.on('SOCRATA_VISUALIZATION_ROW_INSPECTOR_SHOW', function(event) {

      var payload = event.originalEvent.detail.data;

      // Show the row inspector
      if (payload !== null) {

        console.log('showing flannel', payload.position);

      }
    });

    $featureMapElement.on('SOCRATA_VISUALIZATION_ROW_INSPECTOR_UPDATE', function(event) {

      var payload = event.originalEvent.detail.data;

      // Update the row inspector
      if (payload !== null) {

        console.log('updating flannel', payload.data);

      }
    });

    $featureMapElement.on('SOCRATA_VISUALIZATION_ROW_INSPECTOR_HIDE', function(event) {

      console.log('hiding flannel');
    });

  </script>
</html>
