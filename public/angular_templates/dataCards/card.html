<div class="card-text">
  <div class="title-one-line dynamic-title" ng-show="displayDynamicTitle">{{dynamicTitle}}</div>
  <div class="title-one-line">
    <div class="wrap">{{title}}</div>
    <div class="title-expanded">
      <div class="wrap">{{title}}</div>
    </div>
  </div>
  <div class="description"
    ng-class="{
      clamped: descriptionClamped,
      collapsed: descriptionCollapsed,
      'with-animation': animationsOn
    }">
    <div class="description-truncated-content">
      <!-- set in JS -->
    </div>
    <div class="description-expanded-wrapper">
      <div class="description-expanded-content">
        {{description}}
      </div>
      <div class="description-expand-button"
        ng-class="{
          'icon-chevron-down': descriptionCollapsed,
          'icon-chevron-up': !descriptionCollapsed
        }"
        ng-click="descriptionCollapsed = !descriptionCollapsed">
      </div>
    </div>
  </div>
</div>

<div class="card-visualization-wrapper">
  <card-visualization model="model" where-clause="whereClause"></card-visualization>
</div>

<div class="card-controls" ng-show="!isChoosingForExport">
  <div class="card-control icon-settings"
    ng-class="{ disabled: !isCustomizable }"
    ng-click="customizeCardIfCustomizable(isCustomizable)"
    ng-show="editMode && interactive"
    title="{{ isCustomizable ?
      'Customize this card' :
      'There are no customization options for this card yet' }}">
  </div>
  <div ng-attr-title="{{ expanded ? 'Collapse this card' : 'Expand this card' }}"
    ng-click="toggleExpanded()"
    ng-class="{'icon-expand': !expanded, 'icon-collapse': expanded}"
    ng-show="!editMode && interactive"
    class="card-control">
  </div>
  <div class="card-control icon-close"
    title="Remove this card"
    ng-click="deleteCard()"
    ng-show="editMode && interactive && model.fieldName !== '*'">
  </div>
</div>

<div class="card-drag-overlay overlay"
  data-card-id="{{cardState.model.uniqueId}}"
  ng-if="editMode && model.fieldName !== '*'"></div>

<div ng-show="isChoosingForExport"
  class="card-chooser overlay"
  ng-class="{ enabled: isExportable }">
  <div ng-switch="isExportable">
    <a ng-switch-when="true"
      class="action-btn action-png-export"
      href="{{downloadUrl}}"
      ng-click="downloadPng($event)"
      ng-class="{
        disabled: !isExportable,
        working: downloadState === 'loading',
        success: downloadState === 'success',
        error: downloadState === 'error'
      }">
      {{ downloadStateText(downloadState) }}
      <spinner ng-if="downloadState === 'loading'"></spinner>
    </a>
    <span ng-switch-default
      class="action-btn action-png-export export-visualization-disabled disabled">
      {{ downloadStateText(downloadState) }}
    </span>
  </div>
</div>

<div class="flypaper" ng-if="!interactive"></div>
