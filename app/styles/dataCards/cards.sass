@import dataCards/common/colors
@import dataCards/common/layout
@import dataCards/action-button
@import dataCards/aggregation-chooser
@import dataCards/tool-panel
@import dataCards/inputs
@import dataCards/spinner
@import dataCards/customize-bar
@import dataCards/related-views
@import dataCards/histogram


$metadata-top-padding: 7px
$metadata-side-padding: 30px
$filter-height: 58px
// api panel sizes
$api-panel-width: 512px
$api-panel-hint-width: 20px

/* MOBILE/RESPONSIVE DESIGN. SEE DESKTOP-SPECIFIC STYLES BELOW */
body.state-view-cards
  *:focus
    outline-width: 2px

  .cards-metadata
    position: relative
    padding: $metadata-top-padding ($metadata-side-padding / 2)
    border-bottom: 3px solid

    // Custom feature-flag related style hack.
    &.page-header-enabled
      border-top: 3px solid

    .page-description
      margin-top: 1rem
      font-size: 1rem

      .show-more
        height: 1rem
        display: none
        padding-top: 1.5rem
        cursor: pointer

        .show-more-arrow
          margin-left: 5px

        &:before
          content: 'Show more'
        &.less:before
          content: 'Show less'
        &.clamped,&.less
          display: inline-block

    .padded-wrapper
      padding: ($metadata-side-padding / 2)

    .edit-page-name, .edit-page-description
      display: block
      position: relative
      color: inherit

      >.placeholder
        position: absolute
        z-index: 0
        top: 0
        left: 0
        color: inherit
        font-family: inherit

        &::before
          font-family: socrata-apps
          // Make the icon a little bit smaller
          font-size: 0.7em
          line-height: 2em
          padding-left: 0.4em

        span
          display: none
          padding-left: 0.3em
          font: inherit
          font-style: italic
          font-size: 0.9em

      >textarea
        height: 1.2em
        padding-left: 1.2em // make room for edit icon
        margin-bottom: 0.3em
      >textarea, >rich-text-editor
        color: inherit
        font: inherit
        display: block
        width: 100%
        box-sizing: border-box

        // Make sure this is above the placeholder
        position: relative
        z-index: 1

        &:empty + .placeholder > span
          display: inline

        &:focus, &.focus
          outline: 0
          // webkit doesn't give us box shadows unless we nuke its appearance
          -webkit-appearance: none

          + .placeholder
            span
              display: none

      .icon-warning
        position: absolute
        top: 0
        left: 100%
        z-index: 1
        font-size: 0.7em
        margin-left: 0.5rem
        line-height: 1.5em

      [class^="icon-"], [class*=" icon-"]
        cursor: default

    header,.edit-page-name
      font-size: 2rem
    .edit-page-description
      font-size: 1rem

    .activities
      position: relative
      $activities-divider-width: 36px
      text-align: right

      .metadata
        padding-bottom: 10px

        .manage-lens-link
          .modal-dialog
            max-width: 45rem


      .metadatum-wrapper

        &:last-child
          .metadatum
            margin-bottom: 10px

        .metadatum
          padding: 10px 0 0 10px
          white-space: nowrap
          overflow: hidden
          width: 100%
          box-sizing: border-box
          display: block

          span

            &.label
              text-transform: uppercase
              padding-right: 0.3em
              vertical-align: top

            &.value, &.value a
              text-transform: capitalize
              font-weight: bold

            &.value.source-dataset-name a
              text-overflow: ellipsis
              white-space: nowrap
              overflow: hidden
              display: inline-block
              max-width: 15rem

              &.content
                position: relative
                top: 3px

      .save-button
        position: relative

      .download-menu
        $border-width: 2px
        position: relative
        border-width: $border-width
        overflow: visible

        dropdown-menu
          z-index: 1003
          position: absolute
          top: 100%
          // Compensate for the border on the containing button
          margin: 0 #{-$border-width}
          background-color: inherit

          a
            white-space: nowrap
            color: inherit
            display: block
            line-height: 2rem
            text-align: left
            padding: $action-btn-padding-top $action-btn-padding-left

            &:hover
              background-color: $btn-bg-color
              color: $aqua-font-color

            &.download-menu-item-disabled, &.download-menu-item-disabled:hover
              cursor: default
              color: $lt-grey-font-color-rgba
              background-color: inherit

  .cards-content
    position: relative

    #quick-filter-bar-container
      position: relative

      .quick-filter-bar
        position: absolute
        width: 100%
        top: 0
        padding: 0
        box-sizing: border-box
        z-index: 1002

        &.stuck
          position: fixed
          top: 0

        .content
          padding: $metadata-side-padding / 2
          width: 100%
          min-height: 4.5rem
          line-height: 2.75rem
          box-sizing: border-box

          .clear-all-filters-button
            margin: 0

            .icon-close
              font-size: 0.5rem
              margin-left: 0.5rem
              vertical-align: middle

        .action-btn
          line-height: normal

        .filters
          display: inline
          margin-right: 1rem
          line-height: 2rem

        .filter
          // TODO: responsive design for filters when narrow
          display: inline-block
          padding-right: 3px

          span
            opacity: 0.6
            &.light
              opacity: 1

        // buttons in the QFB are gonna look a little different from normal
        .action-btn
          margin: -0.5rem 0
          border-width: 1px

    #card-container
      margin: 0 0 $customize-bar-height + 10px
      position: relative

    .cards
      display: block
      padding: 0

      /* LAYOUT */
      .card-spot
        position: absolute

        .overlay
          position: absolute
          left: 0
          right: 0
          top: 0
          bottom: 0
          z-index: 1000

          &.card-chooser
            @include prefixer(transition, 'background-color 0.1s')

            .action-png-export
              position: absolute
              top: 50%
              left: 50%
              @include prefixer('transform', 'translate(-50%, -50%)')
              @include prefixer(box-shadow, 0 0.2rem 1.3rem -0.1rem rgba(0, 0, 0, 0.3))

        .card-drag-overlay
          // IE9 ignores this overlay for JUST the column chart labels unless you give this
          // a background color (transparent doesn't work).
          background-color: rgba(0, 0, 0, 0)

          cursor: move !important
          cursor: grab !important
          cursor: -webkit-grab !important

        card
          position: absolute
          top: 0
          right: 0
          bottom: 0
          left: 0
          &[data-card-type="table"]
            z-index: 1

          &.dragged
            position: fixed
            z-index: 3000
            opacity: 0.85
            cursor: move !important
            cursor: grabbing !important
            cursor: -webkit-grabbing !important
            @include prefixer(transition, 'width 0.55s, height 0.55s')

            // Don't let our dimensions freak out when we're dragged
            top: inherit
            left: inherit
            width: inherit
            height: inherit

      .card-group-drop-placeholder
        position: absolute
        display: none
        height: 128px
        font-size: 1.5em
        line-height: 128px
        text-align: center
        border-radius: $rounded-corners-border-radius
        box-sizing: border-box

      .card-drop-placeholder
        position: absolute
        left: 0
        right: 0
        top: 0
        bottom: 0
        opacity: 0.5
        border-radius: $rounded-corners-border-radius

      .add-card-button
        position: absolute

  customize-card-dialog
    >h2
      &::before
        font-size: 0.9rem

    card
      width: 100%

    .customize-card-options
      .base-layer-selector
        display: block

    .controls
      overflow: hidden
      clear: both

      button
        float: right


  add-card-dialog
    display: block

    >h2
      &::before
        content: '+'
        line-height: 1.5rem
        font-size: 1.5rem
        font-weight: bold

    .customize-card-options
      padding-top: 3rem

    .card-spot
      position: relative

      .icon-settings
        white-space: nowrap
        padding: 0.2rem 0.3rem 0.3rem
        border-radius: $rounded-corners-border-radius
        display: block

      card.preview
        position: relative
        display: block
        height: 300px
        text-align: left

  .manage-lens-link
    .icon-warning
      margin-left: 0.3rem

    a>small
      font-weight: normal

  manage-lens-dialog
    display: block

    label
      float: left

      soc-select
        // The existence of this soc-select causes the text next to it to
        // align correctly vertically.
        visibility: hidden
        width: 0

    .right
      margin-left: 7em

      .flavor-text
        margin-top: 1rem
        line-height: 1.5em
        position: relative

        .icon-warning
          position: absolute
          right: 100%
          top: 0
          line-height: inherit
          margin-right: 1.5rem

    .controls
      margin-top: 1.5rem
      overflow: hidden

      button
        float: right
        margin-bottom: 0

/* DESKTOP-SPECIFIC STYLES */

@media screen
  @media (min-width: 768px)
    .cards-view
      .cards-metadata
        .metadatum-wrapper
          .span6:first-child
            .metadatum
              // left-hand activities on full-width
              margin-right: 35px

/* VISUALIZATION OPTION CONFIGURATION */
// used when customizing or adding a card
.customize-card-options
  padding-left: 1.875rem
  margin: 1em 0

  h3
    white-space: nowrap
    display: inline-block
    margin: 0 0 1rem
    min-width: 10rem

.configure-map-base-layer
  input
    display: block
    margin-top: 1rem
    width: 100%

visualization-type-selector
  position: top
  margin-bottom: 1rem

  ul
    margin: 0
    padding: 0
    list-style: none
    text-align: right

  ul li
    float: left
    margin: 0 0 1rem
    padding: 0 0.25rem
    width: 33.33%
    min-width: 6rem
    text-align: center
    box-sizing: border-box

    .visualization-type
      position: relative
      display: block
      margin: 0 auto 0.5rem auto
      width: 3rem
      height: 3rem
      font-size: 1.5rem
      color: $dark-btn-font-color
      background-color: $dark-btn-bg-color
      border: 1px solid $dark-btn-border-color
      border-radius: $rounded-corners-border-radius
      cursor: pointer
      outline: none
      overflow: visible

      &:hover
        color: $dark-btn-hover-font-color
        background-color: $dark-btn-hover-bg-color
        border: 1px solid $dark-btn-hover-border-color

      &.selected
        color: $dark-btn-touched-font-color
        background-color: $dark-btn-touched-bg-color
        border: 1px solid $dark-btn-touched-border-color

      &.disabled
        color: $dark-btn-disabled-font-color
        background-color: $dark-btn-disabled-bg-color
        border: 1px solid $dark-btn-disabled-border-color

      &.warn
        .warning-icon
          display: block

      .warning-icon
        position: absolute
        display: none
        padding: 0
        width: 50%
        height: 50%
        top: -15%
        left: 73%
        color: white


/* ICONS AND COMPONENTS */
// card preview used for adding or customizing a card
.customize-card-preview
  position: relative
  display: block
  float: left
  width: 100%
  margin: 1em 0
  text-align: center
  border-radius: $rounded-corners-border-radius
  box-sizing: border-box

  >.card-spot
    >card
      z-index: 1

// add card placeholder layout when no column selected
.add-card-preview-placeholder
  height: 300px
  width: 100%
  display: table

  .placeholder-inner-text
    display: table-cell
    vertical-align: middle
    margin: 0, auto
    padding-left: 1rem
    padding-right: 1rem

// add card styling
.add-card-select-column
  float: left
  width: 19rem

  .column-selector
    margin: 0 1em 0.4em 0

.add-card-controls
  position: absolute
  right: 0.5rem
  top: 0.5rem
  z-index: 2

  >.card-control
    width: $icon-size
    height: $icon-size
    line-height: $icon-size
    font-size: $icon-size
    position: relative
    text-align: center
    cursor: pointer
    display: inline-block

    span
      display: block
      position: relative

  >.add-card-settings
    width: auto
    padding: 0.2rem 0.3rem 0.3rem
    white-space: nowrap
    border-radius: $card-border-width

.add-card-buttons, .mobile-warning-buttons
  text-align: right
  clear: both

  .action-btn
    margin-bottom: 0

[msd-elastic]
  resize: vertical
