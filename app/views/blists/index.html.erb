<% content_for :head do %>
  <%= stylesheet_link_tag "list-screen", "blists-screen", "widgets",
    :cache => "cache/blists_index_all" %>
  <title><%= t(:page_title) %></title>
<% end %>



<div class="twoColumnContainer clearfix">
  <div id="mainColumnContent" class="column mainContent scrollContentColumn">
    <div id='blists'>
      <%= render(:partial => "shared/tabs") %>

      <div class='outerContent'>
        <div class='content'>
          <div class='headerBar clearfix'>
            <h3 id='listTitle' class='clipText'
              title='<%= h(@title) %>'><%= h(@title) %></h3>

            <form class="search blistsFind" action='#'>
              <p>
                <input type='text' class='textPrompt' name='find'
                  title='Find' value='' />
                <input type='image' class='submit' name='findSubmit'
                  src="<%= image_path("find_button.png") %>" />
              </p>
            </form>

            <ul class="headerActions">
              <li><a href='<%= blist_href_new_blist %>' class="add_new"
                title="Create a new <%= t(:blist_name) %> from scratch">
                Design a <%= t(:blist_name).capitalize %>
              </a></li>
              <li>
                <%= link_to("Upload Data", {:controller => "imports", :action => "new"},
                    :class => "import",
                    :title => "Upload a CSV or XML file and we'll convert it into a #{t(:blist_name)}.") %>
              </li>
            </ul>

          </div>

          <div class='gridListContainer'>
            <%#
             This div will hold a copy of the table that displays the header
            %>
            <div class='headerContainer'></div>
            <div class='gridListInner scrollContent'>
              <%= render(:partial => "blist_list") %>
            </div>
          </div>
          
          <%- if (!current_user.is_established?) -%>
            <div class="noticePanel expandContainer">
              <div class="noticeHeaderOuter"><div class="noticeHeaderInner">
                <div class="noticeHeader clearfix">
                  <h2>Get Started!</h2>
                  <p>Have a look at some of the great things you can do with blist.</p>
                  <p class="noticePanelCloser">
                    <a href="#hide" class="expander">Hide</a>
                  </p>
                </div>
              </div></div>
              <div class="noticeContent expandable">
                <%= render(:partial => "shared/feature_boxes") %>
              </div>
            </div>
          <%- end -%>
          
        </div>
      </div>

      <div id="infoPane"></div>
    </div>
  </div>

  <div id="sidebar" class="column scrollContentColumn">
    <% render(:layout => "shared/sidebar_box") do %>
      <%= render(:partial => "shared/current_user_tile", :locals => { :user => current_user }) %>
    <% end %>
    <% render(:layout => "shared/sidebar_box",
      :locals => { :id => 'blistFilters',
      :content_class => 'scrollContent' } ) do %>
      <div class='filterSection items expandableContainer'>
        <a href="#expand_items" class="expander">expand</a>
        <h4>
          <%= sidebar_filter_link("<span>All Items</span>", {}, @args, true) %>
        </h4>
        <ul class="expandable">
          <li>
            <%= sidebar_filter_link("<span>Owned by <em>Me</em></span>",
              {'owner' => current_user.id.to_s}, @args) %>
          <%= contacts_filter_menu('?owner=', '?ownerGroup=',
            'owner', 'owner_group', 'ownerMenu') %>
          </li>
          <li>
            <%= sidebar_filter_link("<span>Shared to <em>Me</em></span>",
              {'shared_to' => current_user.id.to_s}, @args) %>
          <%= contacts_filter_menu('?sharedTo=', '?sharedToGroup=',
            'shared_to', 'shared_to_group', 'sharedToMenu') %>
          </li>
          <li>
            <%= sidebar_filter_link("<span>Shared by <em>Me</em></span>",
              {'shared_by' => current_user.id.to_s}, @args) %>
          <%= contacts_filter_menu('?sharedBy=', '?sharedByGroup=',
            'shared_by', 'shared_by_group', 'sharedByMenu') %>
          </li>
          <li>
            <%= sidebar_filter_link("<span>Show only <em>Favorites</em></span>",
              {'type' => 'favorite'}, @args) %>
          <%= menu_tag({'id' => 'typeMenu', 'items' => [
            { 'text' => 'Favorites', 'href' => '?type=favorite',
              'title' => h(get_title({'type' => 'favorite'})) },
            { 'text' => 'Filtered Views', 'href' => '?type=filter',
              'title' => h(get_title({'type' => 'filter'}))}]}) %>
          </li>
          <%# Deleted items not yet supported, but styled for future
          <li class="deleted"><a href='?filter=deleted:true'><span>Deleted Items</span></a></li>
          # End not yet supported %>
        </ul>
      </div>

      <%# These are not supported yet. Static styling only. TODO: wire them up.
      <div class='filterSection closed projects expandableContainer'>
        <a href="#expand_items" class="expander">expand</a>
        <h4><a href="#TODO"><span>All Projects</span></a></h4>
        <ul>
          <li class="closed expandableContainer">
            <a href="#expand_items" class="expander">expand</a>
            <a href="#TODO"><span>Project Name</span></a>
            <ul class="expandable">
              <li><a href="#TODO"><span>Project Folder Name</span></a></li>
            </ul>
          </li>
          <li><a href="#TODO"><span>Project name</span></a></li>
        </ul>
      </div>
      <div class='filterSection closed folders expandableContainer'>
        <a href="#expand_items" class="expander">expand</a>
        <h4><a href="#TODO"><span>All Folders</span></a></h4>
        <ul class="expandable">
          <li class="not_in_folders"><a href="#"><span>Not in folders</span></a></li>
          <li><a href="#"><span>Folder Name</span></a></li>
          <li><a href="#"><span>Folder Name</span></a></li>
        </ul>
      </div>
      # End unsupported but static styled. %>

      <div class='filterSection closed tags expandableContainer'>
        <a href="#expand_items" class="expander">expand</a>
        <h4>
          <%= sidebar_filter_link("<span>All Tags</span>",
            {'untagged' => 'false'}, @args) %>
        </h4>
        <ul class="expandable">
          <li class='untagged'>
            <%= sidebar_filter_link("<span>Not Tagged</span>",
              {'untagged' => 'true'}, @args) %>
          </li>
          <% get_blist_tags().each do |tag| %>
          <li>
            <%= sidebar_filter_link("<span>#{h(tag)}</span>",
              {'tag' => tag}, @args) %>
          </li>
          <% end %>
        </ul>
      </div>
    <% end %>
  </div>
</div>

<% content_for :js_footer do %>
  <%= render(:partial => "shared/common_js") %>
  <%= javascript_include_tag "plugins/jquery.tablesorter",
    "plugins/jquery.treeTable", "plugins/jquery.searchable", "util/humane-date",
    "widgets/panel-expander", "widgets/dropdown-menu", "widgets/selectable-list",
    "widgets/combination-list", "widgets/sidebar-filter", "widgets/pagination",
    "widgets/info-pane-comments", "screens/blists-screen", "screens/info-pane",
    :cache => "cache/blists_index_all" %>
    <script type="text/javascript" charset="utf-8">
      var form_authenticity_token = "<%= form_authenticity_token %>";
      var request_forgery_protection_token = "<%= request_forgery_protection_token %>";
    </script>
<% end %>
