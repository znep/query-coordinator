<% content_for :head do %>
  <%= rendered_stylesheet_tag 'screen-nominations' %>
<% end %>

<div class='nominationsContainer'>
  <div class='facets'>
    <span class='title'>Filter by Status</span>
    <%- statuses = [{:text => 'All', :value => nil},
      {:text => 'Open', :value => 'pending'},
      {:text => 'Approved', :value => 'approved'},
      {:text => 'Rejected', :value => 'rejected'}] -%>
    <ul>
      <%- statuses.each do |s| -%>
      <li>
      <a href='<%= @base_url + (s[:value].nil? ? '' : '?status=' + s[:value]) %>'
        class='<%= @status == s[:value] ? 'active' : '' %>'><%= s[:text] %></a>
      </li>
      <%- end -%>
    </ul>
  </div>

  <div class='nominationsList'>
    <div class='results'>
      <%- if @nominations_count == 0 -%>
      <div class='noResults'>No Results</div>

      <%- else -%>
      <table class='gridList'>
        <colgroup>
          <col class='user' />
          <col class='details' />
          <col class='attachments' />
          <col class='rating' />
          <col class='status' />
        </colgroup>
        <thead>
          <tr>
            <th class='user'>Submitted by</th>
            <th class='details'>Details</th>
            <th class='attachments'>Files</th>
            <th class='rating'>Rating</th>
            <th class='status'>Status</th>
          </tr>
        </thead>
        <tbody>
          <%- @nominations.each do |n| -%>
          <tr class='item'>
            <td class='user'>
              <a href='<%= n.user.href%>' title='<%= n.user.displayName %>'>
                <%= image_tag n.user.profile_image_path('small'),
                  :alt => n.user.displayName %>
                <span class='userName'><%= n.user.displayName %></span>
              </a>
            </td>
            <td class='details'>
              <span class='title'><%= n.title %></span>
              <div class='submitTime'>
                <%= blist_long_date(n.createdAt) %>
                <span>(<%= friendly_relative_time(n.createdAt) %>)</span>
              </div>
              <%- if !n.description.blank? -%>
              <div class='description'>
                <%= raw(auto_link(h(n.description))) %>
              </div>
              <%- end -%>
            </td>
            <td class='attachments'>
              <ul>
                <% n.attachments.each do |a| %>
                <li>
                <%= link_to(a.filename,
                  "/api/nominations/#{n.id}/attachments/#{a.id}",
                  :title => a.filename, :rel => 'external') %>
                </li>
                <% end %>
              </ul>
            </td>
            <td class='rating
              <%= n.netVotes > 0 ? 'positive' : '' %>
              <%= n.netVotes < 0 ? 'negative' : '' %>'>
              <%= n.netVotes %>
            </td>
            <td class='status <%= n.friendly_status.downcase %>'>
              <%= n.friendly_status.titleize %>
            </td>
          </tr>
          <%- end -%>
        </tbody>
      </table>
      <%- end -%>
    </div>

    <%- if @nominations_count > 0 -%>
    <%- create_pagination(@nominations_count, @page_size,
      params[:page], @base_url, 'button') %>
    <%- end -%>
  </div>
</div>

<%- content_for :modals do -%>
  <div class="nominateDialog modalDialog">
    <a href="#close" class="jqmClose modalDialogClose">Close</a>
    <div class='nominateContent'></div>
  </div>
<%- end -%>

<% content_for :templates do %>
<% end %>

<% content_for :js_footer do %>
  <%= javascript_include_merged 'screen-nominations' %>
<% end %>
