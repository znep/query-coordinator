<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">

<head>
  <meta http-equiv="content-type" content="text/html;charset=utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=8" />
  <%= stylesheet_link_merged 'base' %>
  <%= stylesheet_link_tag "theme/#{CurrentDomain.cname.gsub(/\./, '_')}.css" %>
  <%= stylesheet_link_tag "custom/#{CurrentDomain.theme.stylesheet}" unless CurrentDomain.theme.stylesheet.nil? %>

  <!--[if lt IE 7]>
    <link href="/stylesheets/core-ie6.css" rel="stylesheet" type="text/css">
    <script type="text/javascript" charset="utf-8">
      var isOldIE = true;
    </script>
  <![endif]-->
  <!--[if IE 7]>
    <link href="/stylesheets/core-ie7.css" rel="stylesheet" type="text/css">
  <![endif]-->

  <% if ENV["RAILS_ENV"] != 'production' %>
  <script src="/javascripts/jquery-1.3.2.js" type="text/javascript"
    charset="utf-8"></script>
  <% else %>
  <script type="text/javascript">
    document.write([
        "\<script src='",
        ("https:" == document.location.protocol) ? "https://" : "http://",
        "ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js' type='text/javascript'>\<\/script>"
    ].join(''));
  </script>
  <% end %>
  <%= javascript_error_helper_tag %>

  <%= yield :head %>

  <%- if is_gov_site? -%>
  <%= stylesheet_link_tag "gov-override" %>
  <%- end -%>

  <link rel="shortcut icon" href="<%= theme_image(CurrentDomain.theme.images.favicon) %>" />


</head>

<body id='<%= @body_id %>' class='<%= @body_class %>'>
<div class="bodyExterior">
<div class="bodyInterior">
  <div id='outerContainer'>
    <div id='header'>
      <h1 id='mainLogo' class='<%= @is_marketing_page ? "aboutLogo" : "appLogo" %>'>
        <%= link_to(CurrentDomain.strings.company, root_path) %>
      </h1>

      <div id='mainNav'<%= " class='currentUserNav'" if current_user %>>
        <ul class="clearfix">
          <%# Discovery Module %>
          <% module_enabled :discovery_module do %>
            <li class='discover'><%= link_to("<span>Public Data</span>", root_path) %></li>
          <% end %>

          <%# Community Module %>
          <% module_enabled :community_module do %>
            <li class='community'><%= link_to("<span>Community</span>", community_path) %></li>
          <% end %>

          <%# Home (Features enabled/disabled within this tab) %>
          <li class='home last'>
            <%= link_to("<span>My #{CurrentDomain.strings.company}</span>", home_path) %>

            <%- if (current_user) -%>
              <ul class="subNav">
                <%# Only show the datasets subtab if they're a member of the org or if the
                    org has :community_creation %>
                <% if (module_enabled?(:community_creation) || CurrentDomain.member?(current_user)) %>
                  <li><%= link_to "<span>#{t(:blists_name).titleize}</span>", blists_path %></li>
                <% end %>

                <%# Only show "Friends" if they have community or are a member of the org %>
                <% if (module_enabled?(:community_module) || CurrentDomain.member?(current_user)) %>
                  <li><%= link_to "<span>Friends</span>", contacts_path %></li>
                <% end %>

                <%# "Profile" is always displayed %>
                <li class="<%= 'last' unless (upsell? || 
                      (module_enabled?(:publisher_comment_moderation) && CurrentDomain.member?(current_user))) %>">
                  <%= link_to "<span>Profile</span>", current_user.href %>
                </li>

                <%# Only showed to org members when the module is enabled %>
                <%- if (CurrentDomain.member?(current_user) && module_enabled?(:publisher_comment_moderation)) -%>
                  <li class="last">
                  <%= link_to '<span>Approvals</span>', approval_path %>
                  </li>
                <%- elsif upsell?-%>
                  <li class="last">
                  <%= link_to '<span>Approvals</span>', '/popup/premium', :rel => "modal" %>
                  </li>
                <%- end -%>
              </ul>
            <%- end -%>
          </li>
        </ul>
      </div>

      <div class='userNav'>
        <ul>
          <%- CurrentDomain.theme.urls.header.each do |link| -%>
            <li><%= link_from_theme(link) %></li>
          <%- end -%>
          <li class='signInLink'><%= link_to "Sign In", login_url, :rel => 'nofollow' %></li>
          <li class='signUpLink'><%= link_to "Sign Up", signup_url, :rel => 'nofollow' %></li>
          <li class='accountLink'><%= link_to "My Account", account_path%></li>
          <li class='signOutLink'><a href='/logout' rel='nofollow'>Sign Out</a></li>
        </ul>
      </div>

      <%# This is not supported yet
      <div class='notifications'>
        <ul>
          <li><a href='#' class='messages' title='Messages'>1</a></li>
          <li><a href='#' class='requests' title='Requests'>3</a></li>
        </ul>
      </div>
      %>

      <%- if @show_search_form -%>
        <% form_tag(root_path, :method => :get, :class => "search") do %>
          <p>
            <input type='text' class='textPrompt' name='search'
              title='<%= t(:search_prompt_text) %>'
              value='<%= @discover_search %>' />
            <input type='image' class='submit' name='discoverSubmit' src='/stylesheets/images/common/empty.gif' />
          </p>
        <% end %>
      <%- end -%>
    </div>

    <%= yield :layout %>

    
  </div>
</div>
</div>

<div class="footerContainer">
  <div id='footer' class="clearfix">
    <span class='copyright'><%= CurrentDomain.strings.copyright_string %></span>
    <ul class="clearfix">
      <%- CurrentDomain.theme.urls.footer.each do |link| -%>
        <li><%= link_from_theme(link) %></li>
      <%- end -%>
    </ul>
  </div>
</div>

  <% dialog_content("jqmAlert") do %>
    <div class='header'>
      <h1>Alert</h1>
    </div>

    <div class='mainContent clearfix'>
      <p class='alertMessage'></p>

      <ul class='actionButtons'>
        <li><a href='#close' class='arrowButton jqmClose'>Close</a></li>
      </ul>
    </div>
  <% end %>

  <%#
  Better to load JS at the bottom:
  http://developer.yahoo.com/performance/rules.html#js_bottom
  %>
  <%= javascript_include_merged 'base' %>

  <% if ENV["RAILS_ENV"] != 'production' %>
    <%= javascript_include_tag "util/debug" %>
  <% end %>

  <%# This should be included on all pages, including the marketing site.
  It will update the header appropriately based on your logged-in state %>
  <script type="text/javascript">
    jQuery((function ($)
    {
        var blistCookie = $.cookies.get('_blist_session_id');
        if (blistCookie && blistCookie !== "")
        {
            var coreCookie = unescape(blistCookie).split("||");
            if (coreCookie[0] && coreCookie[0] !== "")
            {
                $('#header .userNav').addClass('loggedInNav');
            }
        }
    })(jQuery));
  </script>


  <%= yield :js_footer %>
  
  <div class="jqmWindow" id="modal"></div>

  <% unless APP_CONFIG['google_analytics_id'].blank? %>
    <script type="text/javascript">
    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
    try {
      var pageTracker = _gat._getTracker("<%= APP_CONFIG['google_analytics_id'] %>");
      pageTracker._trackPageview();
    } catch(err) {}</script>
  <% end %>
  <%= render(:partial => "shared/quantcast") %>
</body>
</html>
