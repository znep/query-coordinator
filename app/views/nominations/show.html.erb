<% content_for :head do %>
  <%= rendered_stylesheet_tag 'screen-nominations' %>
<% end %>

<div class='nominationsContainer'>
  <div class='facets'>
    <span class='title'>Filter by Status</span>
    <%- statuses = [{:text => 'All', :value => nil},
      {:text => 'Open', :value => 'pending'},
      {:text => 'Approved', :value => 'approved'},
      {:text => 'Rejected', :value => 'rejected'}] -%>
    <ul>
      <%- statuses.each do |s| -%>
      <li>
      <a href='<%= @base_url + (s[:value].nil? ? '' : '?status=' + s[:value]) %>'
        class='<%= @status == s[:value] ? 'active' : '' %>'><%= s[:text] %></a>
      </li>
      <%- end -%>
    </ul>
  </div>

  <div class='nominationsList'>
    <%- if !current_user.nil? -%>
    <a href='#Submit dataset' class='button nominateLink'>Suggest a Dataset</a>
    <%- end -%>

    <div class='results'>
      <%- if @nominations_count == 0 -%>
      <div class='noResults'>No Results</div>

      <%- else -%>
      <table class='gridList'>
        <colgroup>
          <col class='user' />
          <col class='details' />
          <col class='attachments' />
          <col class='rating' />
          <col class='status' />
        </colgroup>
        <thead>
          <tr>
            <th class='user'>Submitted by</th>
            <th class='details'>Details</th>
            <th class='attachments'>Files</th>
            <th class='rating'>Rating</th>
            <th class='status'>Status</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
      <%- end -%>
    </div>

    <%- if @nominations_count > 0 -%>
    <%- create_pagination(@nominations_count, @page_size,
      params[:page], @base_url, 'button') %>
    <%- end -%>
  </div>
</div>

<%- content_for :modals do -%>
  <div class="nominateDialog modalDialog">
    <a href="#close" class="jqmClose modalDialogClose">Close</a>
    <h2>Suggest a Dataset</h2>
    <div class="loadingOverlay hide"></div>
    <div class="loadingSpinner hide"></div>
    <form class='nominateContent commonForm'>
      <div class='line'>
        <label for='nominateTitle' class='required'>Title</label>
        <input id='nominateTitle' name='nominate_title' type='text'
          class='required textPrompt' title='Enter a title' />
      </div>
      <div class='line'>
        <label for='nominateDescription'>Description</label>
        <textarea id='nominateDescription' name='nominate_description'
          class='textPrompt' title='Enter details about your suggestion'></textarea>
      </div>
      <div class='line'>
        <label for='nominateFile'>Attachment</label>
        <input type='text' readonly='readonly' disabled='disabled'
          class='fileReadout' name='file_upload' />
        <a href='#Browse' class='button fileBrowseButton'>Browse</a>
      </div>
      <span class='required'>Required</span>
    </form>
    <div class='mainError'></div>
    <ul class='actions'>
      <li><a href='#Cancel' class='jqmClose button'>Cancel</a></li>
      <li><a href='#Submit' class='submitAction button'>Submit</a></li>
    </ul>
  </div>
<%- end -%>

<% content_for :templates do %>
<table class='nominationItem'>
  <tbody>
    <tr class='item'>
      <td class='user'>
        <a><img /><span class='userName'></span></a>
      </td>
      <td class='details'>
        <span class='title'></span>
        <div class='submitTime'>
          <span class='fullTime'></span>
          (<span class='relativeTime'></span>)
        </div>
        <div class='description'></div>
      </td>
      <td class='attachments'>
        <ul><li><a rel='external'></a></li></ul>
      </td>
      <td class='rating'></td>
      <td class='status'></td>
    </tr>
  </tbody>
</table>
<% end %>

<% content_for :js_footer do %>
  <script type='text/javascript'>
    blist.namespace.fetch('blist.nominations');
    blist.nominations.items = [];
    <%- @nominations.each do |n| -%>
    blist.nominations.items.push(<%= safe_json(n) %>);
    <%- end -%>
  </script>
  <%= javascript_include_merged 'screen-nominations' %>
<% end %>
