<%# locals: view, page_single  %>
<%- 
  isDuplicateEnabled = false
-%>
<%- 
  expander_class = page_single ? "expander expanded" : "expander" 
  div_shown = page_single ? "style='display:block;'" : ""
-%>
<%- is_owner = current_user && view.owner.id == current_user.id -%>
<div class="header">
  <ul class="summaryTabs clearfix">
    <li id="tabComments" class="comments active">
      <div class="tabOuter"><div class="tabInner active">
        <a href="#expand" class="<%= expander_class %>" title="more info">more info</a>
        <a href="#comments">Comments</a>
      </div></div>
    </li>
    <li id="tabFiltered">
      <div class="tabOuter"><div class="tabInner">
        <a href="#expand" class="<%= expander_class %>" title="more info">more info</a>
        <a href="#filtered_views">More Views</a>
      </div></div>
    </li>
    <li id="tabSharing">
      <div class="tabOuter"><div class="tabInner">
        <a href="#expand" class="<%= expander_class %>" title="more info">more info</a>
        <a href="#sharing_permissions">Sharing</a>
      </div></div>
    </li>
    <li id="tabPublishing">
      <div class="tabOuter"><div class="tabInner">
        <a href="#expand" class="<%= expander_class %>" title="more info">more info</a>
        <a href="#publishing">Publishing</a>
      </div></div>
    </li>
    <li id="tabActivity">
      <div class="tabOuter"><div class="tabInner">
        <a href="#expand" class="<%= expander_class %>" title="more info">more info</a>
        <a href="#activity">Activity</a>
      </div></div>
    </li>
    <li id="tabSummary">
      <div class="tabOuter"><div class="tabInner">
        <a href="#expand" class="<%= expander_class %>" title="more info">more info</a>
        <a href="#summary">Summary</a>
      </div></div>
    </li>
  </ul>
</div>


<%# *** START: SUMMARY *** %>
<div class="infoContentOuter singleInfoSummary listContainer <%= page_single ? ' expanded' : '' %>">
  <div class="infoContentHeader clearfix">
    <%= render(:partial => "blists/info_summary_header",
                :locals => {:view => view, :page_single => page_single, 
                            :allow_edit => is_owner, :in_widget => false }) %>
  </div>
  <div class="infoContentInner"><div class="infoContentWrapper">
    <div class="infoContent"<%= div_shown %>>
      <%= render( :partial => "blists/meta_tab_summary", 
                  :locals => {:view => view, :page_single => page_single, 
                              :allow_edit => is_owner, :in_widget => false }) %>
    </div> <!-- /.infoContent -->
  </div></div> <!-- /.infoContentInner -->
</div>
<%# *** END: SUMMARY *** %>

<%# *** START: FILTERED *** %>
<div class="infoContentOuter singleInfoFiltered">
  <div class="infoContentHeader clearfix">
    <h2 class="panelHeader">
      <%= pluralize(view.filters.length, "Filtered View") %>
    </h2>
    <%- if current_user -%>
    <ul class="headerActions actionButtons">
      <li><%= link_to("Create", view.href + "?popup=SaveLens", :class => "arrowButton showFlashPopup") %></li>
    </ul>
    <%- end -%>
  </div>
  <div class="infoContentInner"><div class="infoContentWrapper">
    <div class="infoContent"<%= div_shown %>>
      <%= render( :partial => "blists/meta_tab_filtered", 
                  :locals => {:view => view, :in_widget => false }) %>
    </div>
  </div></div>
</div>
<%# *** END: FILTERED *** %>


<%# *** START: COMMENTS *** %>
<div class="infoContentOuter singleInfoComments listContainer
  active <%= page_single ? 'expanded' : '' %>">
  <div class="infoContentHeader clearfix">
    <%= render(:partial => "blists/info_comments_header", 
                :locals => {:view => view, :allow_commenting => true, :in_widget => false }) %>
  </div>
  <div class="infoContentInner"><div class="infoContentWrapper">
    <div class="infoContent"<%= div_shown %>>
      <%= render( :partial => "blists/meta_tab_comments", 
                  :locals => {:view => view, :allow_commenting => true }) %>
    </div>
  </div></div>
</div>
<%# *** END: COMMENTS *** %>


<%# *** START: SHARING *** %>
<div class="infoContentOuter singleInfoSharing">
  <div class="infoContentHeader clearfix">
    <%- shares = view.shares -%>
    <h2 class="panelHeader first"><%= pluralize(shares.length, 'Share') %></h2>
    <h2 class="panelHeader <%= view.shares.size > 0 ? '' : ' last' %> <%= get_permissions_icon_class_for_view(view) %>">
      <%= view.is_public? ? "Public" : "Private" %>
    </h2>
    <%- if view.shares.size > 0 %>
      <h2 class="panelHeader typeNotify last">
        <% form_tag(url_for(:controller => :blists, 
          :action => :notify_all_of_changes)) do %>
          <a href="#" id="notifyAll">Notify all of changes</a>
          <%= image_tag("/images/throbber.gif", 
                      :size => "16x16", 
                      :alt => "Notifying...", 
                      :id => "throbber") %>
        <% end %>
      </h2>
    <% end %>
    <%- if is_owner -%>
    <ul class="headerActions actionButtons">
      <li><a href="<%= "#{view.href}?popup=SharingEditor" %>"
        class="arrowButton showFlashPopup" title="Share">Share</a></li>
    </ul>
    <%- end -%>
    <div class="socialActions">
      <a href='#' title='Share on Social Networks' id='shareInfoLink'>Share on Social Networks</a>
	    <%= menu_tag(socialize_menu_options(view, 'shareInfoMenu')) %>
    </div>
    </ul>
    
  </div>
  <div class="infoContentInner"><div class="infoContentWrapper">
    <div class="infoContent"<%= div_shown %>>
      <div class="sharingSummary">
        <p class="<%= view.is_public? ? "public" : (view.is_shared? ?
          "privateShared" : "private") %>">
        This <%= view.is_blist? ? t(:blist_name) : "filter" %> is
        <%- if is_owner && view.tableOwner.id == view.owner.id -%>
        <a href='#toggle-permissions_<%= view.id %>'
          class='switchPermsLink'><%= view.is_public? ?
            "Public" : "Private" %></a>
        <%- else -%>
        <span><%= view.is_public? ? "Public" : "Private" %></span>
        <%- end -%>
        <%= view.is_shared? ? ' and shared with the following ' +
        (shares.length == 1 ? 'friend' : 'friend'.pluralize) + ':' : '' %>
        </p>
      </div>

      <div class="gridListContainer">
        <table class="gridList" cellspacing="0">
          <colgroup>
            <col class='picture' />
            <col class='contact' />
            <col class='role' />
            <col class='actionContainer' />
          </colgroup>
          <thead>
            <tr>
              <th class="picture" title="Friend"><div></div></th>
              <th class="contact" title="Friend">
                <div>Friend</div>
              </th>
              <th class="role" title="Role"><div>Role</div></th>
              <%# Not supported
              <th class="others"><div>Can Share w/ Others</div></th>
              <th class="opened"><div>Last Opened</div></th>
              %>
              <th class="actionContainer last"></th>
            </tr>
          </thead>
          <tbody>
            <%- view.shares.sort {|a,b|
              a.type <=> b.type ||
              a.member_name.downcase <=> b.member_name.downcase}.each do |s| -%>
            <tr class="item">
              <td class="picture">
                <div class="cellInner">
                  <%- if s.member_id -%>
                    <a href="<%= User.href(s.member_name, s.member_id) %>"><%= image_tag(s.member_image, :size => "24x24", :alt => h(s.member_name)) %></a>
                  <%- else -%>
                    <%= image_tag(s.member_image, :size => "24x24", :alt => h(s.member_name)) %>
                  <%- end -%>
                </div>
              </td>
              <td class="contact"><div class="cellInner"><%= h(s.member_name) %></div></td>
              <td class="role"><div class="cellInner"><%= s.type %></div></td>
              <%# Not supported
              <td class="others"><div>Yes</div></td>
              <td class="opened"><div>01/09/2009</div></td>
              %>
              <td class="actionContainer"><div class="cellInner">
                  <%- if s.member_id -%>
                    <a href="<%= User.href(s.member_name, s.member_id) %>" class="action"><span>View Profile</span></a>
                  <%- end -%>
              </div></td>
            </tr>
            <%- end -%>
          </tbody>
        </table>
      </div>
    </div>
  </div></div>
</div>
<%# *** END: SHARING *** %>

<%# *** START: PUBLISHING *** %>
<div class="infoContentOuter singleInfoPublishing">
  <div class="infoContentHeader clearfix">
    <h2 class="panelHeader">Publishing</h2>
    <%# Not supported
    <h2 class="panelHeader">3212 total views</h2>
    %>
  </div>
  <div class="infoContentInner"><div class="infoContentWrapper">
    <div class="infoContent"<%= div_shown %>>
      <%= render( :partial => "blists/meta_tab_publishing", 
                  :locals => {:view => view, :in_widget => false }) %>
    </div>
  </div></div>
</div>
<%# *** END: PUBLISHING *** %>

<%# *** START: ACTIVITY *** %>
<div class="infoContentOuter singleInfoActivity">
  <div class="infoContentHeader clearfix">
    <%= render(:partial => "blists/info_activity_header", 
                :locals => {:view => view, :in_widget => false }) %>
  </div>
  <div class="infoContentInner"><div class="infoContentWrapper">
    <div class="infoContent"<%= div_shown %>>
      <%= render( :partial => "blists/meta_tab_activity", 
                  :locals => {:view => view, :in_widget => false }) %>
    </div>
  </div></div>
</div>
<%# *** END: ACTIVITY *** %>
