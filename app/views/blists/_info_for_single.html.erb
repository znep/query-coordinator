<%# locals: view, page_single  %>

<div class="header">
  <ul class="summaryTabs clearfix">
    <li id="tabSummary" class="summary active">
      <div class="tabInner">
        <a href="#expand" class="expander">expand</a>
        <a href="#summary">Summary</a>
      </div>
    </li>
    <li id="tabFiltered">
      <div class="tabInner">
        <a href="#expand" class="expander">expand</a>
        <a href="#filtered_views">Filtered Views</a>
      </div>
    </li>
    <li id="tabSharing">
      <div class="tabInner">
        <a href="#expand" class="expander">expand</a>
        <a href="#sharing_permissions">Sharing</a>
      </div>
    </li>
    <li id="tabPublishing">
      <div class="tabInner">
        <a href="#publishing">Publishing</a>
      </div>
    </li>
    <li id="tabActivity" class="last">
      <div class="tabInner">
        <a href="#expand" class="expander">expand</a>
        <a href="#activity">Activity</a>
      </div>
    </li>
  </ul>
</div>

<%# *** START: SUMMARY *** %>
<div class="infoContentOuter singleInfoSummary listContainer active">
  <div class="infoContentHeader clearfix">
    <h2 class="panelHeader <%= get_permissions_icon_class_for_view(view) %>">
      <%= page_single ? h(view.name) : link_to(h(view.name), blist_url(view.id)) %>
    </h2>
    <ul class="headerActions actionButtons">
      <%- unless (page_single) -%>
        <li><a href="<%= blist_url(view.id) %>" class="arrowButton">Open</a></li>
      <%- end -%>
      <li><a href="#duplicate">Duplicate</a></li>
      <li><a href="<%= blist_url(view.id, {:popup => 'SharingEditor'}) %>"
        class="showFlashPopup">Share</a></li>
    </ul>
  </div>
  <div class="infoContentInner">
    <div class="infoContent">

      <dl class="summaryList">
        <dt>
          Description
          <a href="#help" class="help"><span>help</span></a>
        </dt>
        <dd>
          <div class="itemContent">
            <span><%= h(view.description) %></span>
          </div>
          <div class="itemActions">
            <a href="#unselect" class="action"><span>Edit</span></a>
          </div>
        </dd>
      </dl>

      <%- if (view.tags.length > 0) -%>
      <dl class="summaryList">
        <dt>
          Tags
          <a href="#help" class="help"><span>help</span></a>
        </dt>
        <dd>
          <div class="itemContent">
            <span><%= h(view.tag_display_string) %></span>
          </div>
          <div class="itemActions">
            <a href="#unselect" class="action"><span>Edit</span></a>
          </div>
        </dd>
      </dl>
      <%- end -%>

      <dl class="summaryList">
        <dt>
          Category
          <a href="#help" class="help"><span>help</span></a>
        </dt>
        <dd class="itemBlist">
          <div class="itemContent">
            <span><%= h(view.category) %></span>
          </div>
          <div class="itemActions">
            <a href="#unselect" class="action"><span>Edit</span></a>
          </div>
        </dd>
      </dl>

      <dl class="summaryList">
        <dt>
          Owner
          <a href="#help" class="help"><span>help</span></a>
        </dt>
        <dd>
          <div class="itemContent">
            <span><%= h(view.owner.displayName) %></span>
          </div>
        </dd>
      </dl>

      <dl class="summaryList">
        <dt>
          Created On
          <a href="#help" class="help"><span>help</span></a>
        </dt>
        <dd>
          <div class="itemContent">
            <span><%= blist_date(view.createdAt) %></span>
          </div>
        </dd>
      </dl>

      <dl class="summaryList">
        <dt>
          Last Update
          <a href="#help" class="help"><span>help</span></a>
        </dt>
        <dd>
          <div class="itemContent">
            <span><%= up_user = view.last_updated_user
              h(up_user.nil? ? '' : up_user.displayName + ':') %>
              <%= blist_date(view.rowsUpdatedAt) || blist_date(view.createdAt) %>
            </span>
          </div>
          <div class="itemActions">
            <a href="#tabActivity" class="action tabLink activity">
              <span>View Activity</span>
            </a>
          </div>
        </dd>
      </dl>

      <dl class="summaryList">
        <dt>
          Filtered Views
          <a href="#help" class="help"><span>help</span></a>
        </dt>
        <dd>
          <div class="itemContent">
            <span><%= pluralize(view.filters.length, "filtered view") %></span>
          </div>
          <div class="itemActions">
            <a href="#tabFiltered" class="action tabLink filtered">
              <span>Details</span>
            </a>
          </div>
        </dd>
      </dl>

      <dl class="summaryList">
        <dt>
          Community Activity
          <a href="#help" class="help"><span>help</span></a>
        </dt>
        <dd>
          <div class="itemContent">
            <ul>
              <li><%= pluralize(view.viewCount, " view") %></li>
              <li>[11 copies]</li>
            </ul>
          </div>
          <div class="itemActions">
            <a href="#tabActivity" class="action tabLink activity">
              <span>View Activity</span>
            </a>
          </div>
        </dd>
      </dl>

      <dl class="summaryList">
        <dt>
          Link
          <a href="#help" class="help"><span>help</span></a>
        </dt>
        <dd>
          <div class="itemContent">
            <span>[http://app.blist.com/?variant=debug#/blist/kmerritt/]<%= view.urlName %></span>
          </div>
          <div class="itemActions">
            <a href="#publish" class="action tabLink publishing">
              <span>Publish</span>
            </a>
          </div>
        </dd>
      </dl>

      <dl class="summaryList">
        <dt>
          Permissions
          <a href="#help" class="help"><span>help</span></a>
        </dt>
        <dd>
          <div class="itemContent">
            <span><%= view.is_public? ? 'Public' : 'Private' %></span>
          </div>
          <div class="itemActions">
            <a href="#unselect" class="action"><span>Edit</span></a>
          </div>
        </dd>
      </dl>

      <dl class="summaryList">
        <dt>
          Sharing
          <a href="#help" class="help"><span>help</span></a>
        </dt>
        <dd>
          <div class="itemContent">
            <ul>
              <li>
                <%= pluralize(view.contributor_users.length, 'Contributor') %>
              </li>
              <li>
                <%= pluralize(view.viewer_users.length, 'Viewer') %>
              </li>
              <%# Not supported
              <li>[3 Requests]</li>
              %>
            </ul>
          </div>
          <ul class="itemActions">
            <li><a href="#share" class="action tabLink sharing">
              <span>Share</span></a>
            </li>
            <%# Not supported
            <li><a href="#view_requests" class="action"><span>View Requests</span></a></li>
            %>
          </ul>
        </dd>
      </dl>

    </div> <!-- /.infoContent -->
  </div> <!-- /.infoContentInner -->
</div>
<%# *** END: SUMMARY *** %>

<%# *** START: FILTERED *** %>
<div class="infoContentOuter singleInfoFiltered">
  <div class="infoContentHeader clearfix">
    <h2 class="panelHeader">
      <%= pluralize(view.filters.length, "Filtered View") %>
    </h2>
    <ul class="headerActions actionButtons">
      <li><a href="#open" class="arrowButton">Create</a></li>
    </ul>
  </div>
  <div class="infoContentInner">
    <div class="infoContent">
      <div class="gridListContainer">
        <table class="gridList" cellspacing="0">
          <colgroup>
            <col class='handle' />
            <col class='favorite' />
            <col class='type' />
            <col class='name' />
            <col class='description' />
            <col class='viewed' />
            <col class='actionContainer' />
          </colgroup>
          <thead>
            <tr>
              <th class="handle first"><div></div></th>
              <th class="favorite" title="Favorite?"><div>Favorite?</div></th>
              <th class="type" title="Type"><div>Type</div></th>
              <th class="name"><div>Name</div></th>
              <th class="description"><div>Description</div></th>
              <th class="viewed"><div>Viewed</div></th>
              <th class="actionContainer last"></th>
            </tr>
          </thead>
          <tbody>
            <%- view.filters.each do |filter| -%>
              <tr class="item">
                <td class="handle"><div></div></td>
                <td class="favorite <%= filter.flag?('favorite') %>"><div>
                    <span class="favoriteMarker"><%= filter.flag?('favorite') ? "favorite" : "" %></span>
                </div></td>
                <td class="type"><div class="<%=
                  get_share_direction_icon_class_for_view(filter) %>">
                  <%= get_type_string_for_view(filter) %></div>
                </td>
                <td class="name"><div><%= link_to(h(filter.name), blist_url(filter.id)) %></div></td>
                <td class="description"><div><%= h(filter.description) %></div></td>
                <td class="viewed"><div><%= blist_date(filter.lastOpenedDate) %>
                </div></td>
                <td class="actionContainer"><div><a
                      href="<%= blist_url(filter.id) %>" class="action"
                      title="<%= h(filter.name) %>"><span>View</span></a>
                </div></td>
              </tr>
            <%- end -%>
          </tbody>
        </table>
      </div>


    </div>
  </div>
</div>
<%# *** END: FILTERED *** %>

<%# *** START: SHARING *** %>
<div class="infoContentOuter singleInfoSharing">
  <div class="infoContentHeader clearfix">
    <%- shares = view.shares -%>
    <h2 class="panelHeader first"><%= pluralize(shares.length, 'Share') %></h2>
    <h2 class="panelHeader <%= get_permissions_icon_class_for_view(view) %>">
      <%= view.is_public? ? "Public" : "Private" %>
    </h2>
    <ul class="headerActions actionButtons">
      <li><a href="<%= blist_url(view.id, {:popup => 'SharingEditor'}) %>"
        class="arrowButton showFlashPopup" title="Share">Share</a></li>
    </ul>
  </div>
  <div class="infoContentInner">
    <div class="infoContent">
      <div class="sharingSummary">
        <p class="<%= view.is_public? ? "public" : (view.is_shared? ?
          "privateShared" : "private") %>">
        This <%= view.is_blist? ? "blist" : "filter" %> is
        <em><%= view.is_public? ? "Public" : "Private" %></em>
        <%= view.is_shared? ? ' and shared with the following ' +
        (shares.length == 1 ? 'contact' : 'contact'.pluralize) + ':' : '' %>
        </p>
      </div>

      <div class="gridListContainer">
        <table class="gridList" cellspacing="0">
          <colgroup>
            <col class='handle' />
            <col class='contact' />
            <col class='role' />
            <col class='actionContainer' />
          </colgroup>
          <thead>
            <tr>
              <th class="handle first"><div></div></th>
              <th class="contact" title="Contact/Group">
                <div>Contact / Group</div>
              </th>
              <th class="role" title="Role"><div>Role</div></th>
              <%# Not supported
              <th class="others"><div>Can Share w/ Others</div></th>
              <th class="opened"><div>Last Opened</div></th>
              %>
              <th class="actionContainer last"></th>
            </tr>
          </thead>
          <tbody>
            <%- view.shares.sort {|a,b|
              a.type <=> b.type ||
              a.member_name.downcase <=> b.member_name.downcase}.each do |s| -%>
            <tr class="item">
              <td class="handle"><div></div></td>
              <td class="contact"><div><%= h(s.member_name) %></div></td>
              <td class="role"><div><%= s.type %></div></td>
              <%# Not supported
              <td class="others"><div>Yes</div></td>
              <td class="opened"><div>01/09/2009</div></td>
              %>
              <td class="actionContainer"><div>
                <a href="#view" class="action"><span>View Activity</span></a>
              </div></td>
            </tr>
            <%- end -%>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>
<%# *** END: FILTERED *** %>

<%# *** START: PUBLISHING *** %>
<div class="infoContentOuter singleInfoPublishing">
  <div class="infoContentHeader clearfix">
    <h2 class="panelHeader">Publishing</h2>
    <%# Not supported
    <h2 class="panelHeader">3212 total views</h2>
    %>
    <ul class="headerActions actionButtons">
      <li><a href="<%= blist_url(view.id, {:popup => 'PublishDialog'}) %>"
        class="arrowButton showFlashPopup">Publish a Widget</a></li>
    </ul>
  </div>
  <div class="infoContentInner">
    <%# Not supported
    <div class="infoContent">
      <div class="gridListContainer simple">
        <table class="gridList" cellspacing="0">
          <thead>
            <tr>
              <th class="widgetBlist first" title="blist/Filter Name"><div>blist / Filter Name</div></th>
              <th class="widgetType" title="Role"><div>Role</div></th>
              <th class="link" title="Link Location"><div>Link Location</div></th>
              <th class="number" title="Number"><div>#</div></th>
              <th class="viewed" title="Last Viewed"><div>Last Viewed</div></th>
              <th class="actionContainer last"></th>
            </tr>
          </thead>
          <tbody>
            <tr class="item">
              <td class="widgetBlist"><div>East Coast Wine Sales</div></td>
              <td class="widgetType"><div>Grid Only</div></td>
              <td class="link"><div>intranet.wineman.com</div></td>
              <td class="number"><div>125</div></td>
              <td class="viewed"><div>01/09/2009</div></td>
              <td class="actionContainer"><div>
                <a href="#view" class="action"><span>Republish</span></a>
              </div></td>
            </tr>
            <tr class="item">
              <td class="widgetBlist"><div>Favorite Wines 2008</div></td>
              <td class="widgetType"><div>Grid with Page</div></td>
              <td class="link"><div>blog.wineman.com</div></td>
              <td class="number"><div>3002</div></td>
              <td class="viewed"><div>01/09/2009</div></td>
              <td class="actionContainer"><div>
                <a href="#view" class="action"><span>Republish</span></a>
              </div></td>
            </tr>
            <tr class="item">
              <td class="widgetBlist"><div>Wedding wine survey</div></td>
              <td class="widgetType"><div>Grid with Form</div></td>
              <td class="link"><div>JillandJacksWedding.com</div></td>
              <td class="number"><div>85</div></td>
              <td class="viewed"><div>01/09/2009</div></td>
              <td class="actionContainer"><div>
                <a href="#view" class="action"><span>Republish</span></a>
              </div></td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
    %>
  </div>
</div>
<%# *** END: PUBLISHING *** %>

<%# *** START: ACTIVITY *** %>
<div class="infoContentOuter singleInfoActivity">
  <div class="infoContentHeader clearfix">
    <h2 class="panelHeader">Activity</h2>
  </div>
  <div class="infoContentInner">
    <div class="infoContent">
      <div class="gridListContainer simple">
        <table class="gridList" cellspacing="0">
          <thead>
            <tr>
              <th class="when first" title="When"><div>When</div></th>
              <th class="who" title="Who"><div>Who</div></th>
              <th class="what" title="What Activity"><div>What Activity</div></th>
              <th class="actionContainer last"></th>
            </tr>
          </thead>
          <tbody>
            <tr class="item">
              <td class="when"><div>[01/09/2009]</div></td>
              <td class="who"><div>[Jim Beam]</div></td>
              <td class="what"><div>[Added new row 1A2B3C]</div></td>
              <td class="actionContainer"><div>
                <a href="#view" class="action"><span>View</span></a>
              </div></td>
            </tr>
            <tr class="item">
              <td class="when"><div>[01/10/2009]</div></td>
              <td class="who"><div>[Jose Cuervo]</div></td>
              <td class="what"><div>[Updated row 1A2B3C]</div></td>
              <td class="actionContainer"><div>
                <a href="#view" class="action"><span>View</span></a>
              </div></td>
            </tr>
            <tr class="item">
              <td class="when"><div>[01/10/2009]</div></td>
              <td class="who"><div>[Jack Daniels]</div></td>
              <td class="what"><div>[Commented]</div></td>
              <td class="actionContainer"><div>
                <a href="#view" class="action"><span>View</span></a>
              </div></td>
            </tr>
            <tr class="item">
              <td class="when"><div>[01/10/2009]</div></td>
              <td class="who"><div>[Jack Daniels]</div></td>
              <td class="what"><div>[Replied to comment]</div></td>
              <td class="actionContainer"><div>
                <a href="#view" class="action"><span>View</span></a>
              </div></td>
            </tr>
            <tr class="item">
              <td class="when"><div>[01/11/2009]</div></td>
              <td class="who"><div>[Jose Cuervo]</div></td>
              <td class="what"><div>[Copied this blist to create "Good Mixers"]</div></td>
              <td class="actionContainer"><div>
                <a href="#view" class="action"><span>View</span></a>
              </div></td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>
<%# *** END: ACTIVITY *** %>
