<form class='formView socrataForm commonForm' method='POST'
  <%- form_columns = @view.columns.select {|c| c.form_enabled?} -%>
  <%- if form_columns.any? {|c| c.client_type == 'document_obsolete' ||
    c.client_type == 'photo_obsolete' || c.client_type == 'document' || c.client_type == 'photo'} -%>
  enctype='multipart/form-data'
  <%- end -%>
  <%- success_redirect = @view.display.options.successRedirect -%>
  <%- def_success_redirect = request.protocol + request.host_with_port + @view.href +
  '/form_success' -%>
  <%- success_redirect = def_success_redirect if success_redirect.blank? -%>
  <%- error_redirect = request.protocol + request.host_with_port + @view.href +
    '/form_error' -%>
  data-defaultSuccessRedirect='<%= def_success_redirect %>'
  action='<%= local_assigns[:prefix] || '' %>/views/<%=
    @view.id %>/rows.html?method=createForm&successRedirect=<%= CGI.escape(success_redirect)
    %>&errorRedirect=<%= CGI.escape(error_redirect) %>'>
  <%- form_columns.each do |c| -%>
  <div class='line clearfix <%= c.client_type %>'>
    <label for='form_field_<%= c.id %>'><%= c.name %></label>
    <%= render(:partial => 'displays/form_field', :locals => {:column => c}) %>
  </div>
  <%- end -%>
  <div class='submitLine'>
    <input type='submit' value='Submit' />
  </div>
  <%- if local_assigns[:show_powered_tag] -%>
  <a href="http://www.socrata.com/" class='poweredLink'
    target="_blank">Powered by Socrata</a>
  <%- end -%>
</form>
