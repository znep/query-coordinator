<% content_for :head do %>
<%= rendered_stylesheet_tag 'internal' %>
<title>Organization <%= @org.nil? ? '' : @org.name %> | Internal Panel |
  <%= CurrentDomain.strings.site_title %></title>
<% end %>

<%= render :partial => 'left_nav' %>

<div class="contentBox withLeftNavigation">
    <div class='content'>

      <%- if @org.nil? -%>
        <p>Organization could not be found</p>

      <%- else -%>
        <h1>Organization: <%= @org.name %></h1>

        <h2>Domains:</h2>
        <%- if @org.domains.nil? || @org.domains.size <= 0 -%>
          <p>No domains for this org.</p>
        <%- else -%>
          <ul>
            <%- @org.domains.each do |domain| -%>
              <li><%= link_to(
                "#{domain.name} (#{domain.cname})",
                show_domain_path(domain_id: domain.cname)
              ) %></li>
          <%- end -%>
        </ul>
      <%- end -%>

      <h2>Create a domain:</h2>
      <%= form_tag('/internal/orgs/' + @org.id.to_s + '/domains') do %>
        <%= hidden_field_tag 'domain[organizationId]', @org.id.to_s %>
        <div class='line'>
          <label>Name:</label>
          <input type="text" name="domain[name]"/>
        </div>
        <div class='line'>
          <label>CName:</label>
          <input type="text" name="domain[cName]"/>
        </div>
        <input type="hidden" name="config[parentDomainCName]" value="<%= @default_domain.cname %>" />
        <input type="hidden" name="domain[parentDomainId]" value="<%= @default_domain.id %>" />
        <input type="submit" value="Create"/>
      <% end %>
    <%- end -%>
  </div>
</div>

<% content_for :js_footer do %>
  <script type="text/javascript">
    $(function() {
      $('input[name="domain[cName]"]').keydown(function() {
        var $this = $(this);
        // Copied from InternalController#valid_cname?
        var validCname = /^[a-zA-Z\d]+([a-zA-Z\d]+|\.(?!(\.|-|_))|-(?!(-|\.|_))|_(?!(_|\.|-)))*[a-zA-Z\d]+$/.test($this.val());
        if (!validCname) {
          $this.css('background-color', '#FF9494');
          // TODO: Should probably add an explanatory warning of some kind.
        } else {
          $this.css('background-color', 'white');
        }
      });
    });
  </script>
<% end %>
