#!/bin/bash

# eslint must be installed.
npm update eslint > /dev/null

NEW_PROBLEMS=`./node_modules/.bin/eslint --ignore-path .eslintignore -c package.json -f compact app | sort | tail -n +3`

git checkout `git merge-base HEAD origin/master`
OLD_PROBLEMS=`./node_modules/.bin/eslint --ignore-path .eslintignore -c package.json -f compact app | sort | tail -n +3`

git checkout -
DELTA=`diff  <(echo "$OLD_PROBLEMS" ) <(echo "$NEW_PROBLEMS") | grep '^> '`

if [ -n "$DELTA" ]; then
  echo
  echo "New errors:"
  echo "$DELTA"
  echo
  false
else
  true
fi
