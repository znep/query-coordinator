<%- prefix = 'screens.admin.connector' %>

<% content_for :head do %>
  <%= rendered_stylesheet_tag 'administration-screen' %>
  <%= rendered_stylesheet_tag 'administration-connectors' %>
  <title><%= t("#{prefix}.title") %> | <%= get_site_title %></title>
<% end %>

<%= render :partial => 'left_nav' %>

<%= include_webpack_bundle 'admin/admin-edit-connector.js' %>

<div id="connector-content" class="contentBox withLeftNavigation">
  <div class="adminHeader connectors">
    <span class="icon"></span>
    <h1><%= t("#{prefix}.edit_connector", url: @server.url) %></h1>
    <%= display_standard_flashes %>
    <div class="connector-list-go-back">
      <%= link_to(t("#{prefix}.back_to_connector_list"),
                  :controller => '/administration/connector',
                  :action => 'connectors') %>
    </div>
  </div>

  <div class="selective-connection">
    <%= form_tag({:action => 'update_connector'}, :method => 'post', :class => 'commonForm') %>
      <h2><%= t("#{prefix}.connection_type") %></h2>
      <% if @data_connection_on %>
      <div class="legend">
        <div class="legend-item">
          <span class="icon-data legend-icon"></span>
          <span class="legend-info">
            <span class= "legend-key"> <%= t("#{prefix}.data_option") %> </span>- <%= t("#{prefix}.data_option_explanation") %>
          </span>
        </div>
        <div class="legend-item">
          <span class="icon-external-square legend-icon"></span>
          <span class="legend-info">
            <span class="legend-key"><%= t("#{prefix}.catalog_option") %> </span>- <%= t("#{prefix}.catalog_option_explanation") %>
          </span>
        </div>
        </div>
        <fieldset class="line">
          <div class="valueBox inline-value">
            <input type="radio" id="dataConnectAll" class="server-sync"
              name="server[sync_type]" value="data"
              <%= @server.data_connect_all? ? 'checked="checked"' : '' %> />
            <label for="dataConnectAll" class="inline-value-label"><%= t("#{prefix}.data_connect_all") %></label>
          </div>
          <div class="valueBox inline-value">
            <input type="radio" id="federateAll" class="server-sync"
              name="server[sync_type]" value="catalog"
              <%= @server.federate_all? ? 'checked="checked"' : '' %> />
            <label for="federateAll" class="inline-value-label"><%= t("#{prefix}.catalog_connect_all") %></label>
          </div>
          <div class="valueBox inline-value">
            <input type="radio" id="connectSome" class="server-sync"
              name="server[sync_type]" value="ignored"
              <%= @server.federate_all? || @server.data_connect_all? ? '' : 'checked="checked"' %> />
            <label for="connectSome" class="inline-value-label"><%= t("#{prefix}.some_assets") %></label>
          </div>
          <input type="submit" value=<%=t("#{prefix}.save")%> class="button inline-button"/>
        </fieldset>
      <% else %>
        <div class="new-connector-form flexbox-space-between">
          <div class="flexbox-left-section">
            <fieldset class="line">
              <div class="valueBox">
                <input type="radio" id="federateAll" class="server-sync"
                  name="server[sync_type]" value="catalog"
                  <%= @server.federate_all? ? 'checked="checked"' : '' %> />
                <label for="federateAll"><%= t("#{prefix}.all_assets") %></label>
              </div>
              <div class="valueBox">
                <input type="radio" id="federateSome" class="server-sync"
                  name="server[sync_type]" value="ignored"
                  <%= @server.federate_all? ? '' : 'checked="checked"' %> />
                <label for="federateAll"><%= t("#{prefix}.some_assets") %></label>
              </div>
          </div> <%# end flex left section %>
          <div class="line clearfix flexbox-right-section">
            <div class="flexbox-upper-right">
              <input type="submit" value=<%=t("#{prefix}.save")%> class="button"/>
            </div>
          </div>
        </div> <%# end flex box container %>
      <% end %>

      <%= form_tag({:action => 'update_connector'}, {:method => 'post', :class => 'commonForm'}) %>
        <fieldset class="line">

          <div class="filter-assets">
            <input
              type="text"
              title="<%= t("#{prefix}.search") %>"
              class="textPrompt searchBox prompt"/>
          </div>

          <div class="esri-tree">
            <%- @tree['folders'].each do |folder| -%>
              <div class="item folder search-item">
                <div class="editItem">
                  <% if @data_connection_on %>
                    <div
                      class="select-style <%= disabled_class(@server)%>"
                      id="style-div-for-<%=folder['id']%>">
                      <%= icon_for_asset(@server, folder) %>
                      <%= folder_select_tag(@server, folder) %>
                    </div>
                  <% else %>
                    <%= folder_check_box(@server, folder) %>
                  <% end %>
                  <span class="asset-name">
                    <%= truncate(folder['name'], length: 120) %>
                  </span>
                </div>

                <%- folder['services'].each do |service| -%>
                  <div class="item child service search-item">
                    <div class="editItem">
                      <% if @data_connection_on %>
                        <div
                          class="select-style <%=disabled_class(@server)%>"
                          id="style-div-for-<%=service['id']%>">
                          <%= icon_for_asset(@server, service) %>
                          <%= service_select_tag(@server, folder, service) %>
                        </div>
                      <% else %>
                        <%= service_check_box(@server, folder, service) %>
                      <% end %>
                      <a target="_blank" href="<%= service['url'] %>"
                        name="<%= service_display_string(service) %>">
                        <span class="asset-name">
                          <%= truncate(service_display_string(service), length: 120) %>
                        </span>
                      </a>
                    </div>

                    <%- service['layers'].each do |layer| -%>
                      <div class="item child layer search-item">
                        <div class="editItem">
                          <% if @data_connection_on %>
                            <div
                              class="select-style <%= disabled_class(@server)%>"
                              id="style-div-for-<%=layer['id']%>">
                              <%= icon_for_asset(@server, layer) %>
                              <%= layer_select_tag(@server, folder, service, layer) %>
                            </div>
                          <% else %>
                            <%= layer_check_box(@server, folder, service, layer) %>
                          <% end %>
                          <a target="_blank" href="<%= layer['url'] %>">
                            <%- if layer['name'].blank? -%>
                              <%= layer['url'] %>
                            <%- else -%>
                              <span class="asset-name">
                                <%= truncate(layer['name'], length: 120) %>
                              </span>
                            <%- end -%>
                          </a>
                        </div>
                      </div>
                    <%- end -%>
                  </div>
                <%- end -%>
              </div>
            <%- end -%>
          </div> <%# end esri-tree container %>
        <%# end inner fieldset tag (by rails)%>
      <%# end outer fieldset tag (by rails) %>
    </form>
  </div>
</div>

<%= render_admin_qualtrics %>
<%= render_translations LocalePart.screens.admin.connector %>
