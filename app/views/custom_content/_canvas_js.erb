<%= include_javascripts 'canvas' %>
<script type="text/javascript">
  blist.assets = {libraries: <%= raw ASSET_MAP.javascripts %>, stylesheets: <%= raw stylesheet_assets.to_json %>};
  blist.namespace.fetch('blist.configuration');
  blist.configuration.development = <%= Rails.env.development? %>;
  blist.configuration.designerEnabled = <%= module_enabled?(:canvas_designer) &&
    !local_assigns[:non_editable] && !page.uneditable &&
    # HACK
    (page.path.start_with?('/reports/') || !module_enabled?(:govStat)) %>;
  blist.configuration.immediateEdit = <%= @edit_mode ? true : false %>;
  blist.configuration.canvasX = <%= module_enabled?(:canvasX) == true %>;
  blist.configuration.govStat = <%= module_enabled?(:govStat) == true %>;

  <%
    staging_lockdown =  (CurrentDomain.feature? :staging_lockdown) || false
  %>

  $(function() {
      var page = blist.configuration.page = new Page(<%= safe_json(page) %>);
      blist.configuration.pageVariables = <%= safe_json(Canvas2::Util.page_vars) %>;
      blist.configuration.env = <%= safe_json(Canvas2::Util.env) %>;
      blist.configuration.availableContexts = <%= safe_json(Canvas2::DataContext.streaming_contexts) %>;
      blist.configuration.extraContextConfig = <%= safe_json(Canvas2::DataContext.extra_config) %>;
      blist.configuration.privateData = <%= page.private_data?  || staging_lockdown %>;

      blist.configuration.newChartsEnabled = <%= module_enabled?(:new_charts) || true %>;
      blist.configuration.newMapsEnabled = <%= module_enabled?(:new_maps) == true %>;
      blist.configuration.oldChartsForced = <%= module_enabled?(:old_charts) == true %>;

      $.dataContext.load(page.data, blist.configuration.availableContexts,
        blist.configuration.extraContextConfig);
      $.component.initialize(page.content);
      <%- if template -%>
      blist.configuration.template = <%= safe_json(template) %>;
      <%- end -%>
  });
</script>

<%- content_for :translations do -%>
  <%= render_translations LocalePart.screens.ds.grid_sidebar %>
<%- end -%>

