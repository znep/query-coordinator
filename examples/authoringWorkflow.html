<!DOCTYPE html>
<html>
  <head>
    <title>Example Usage: AuthoringWorkflow</title>
    <meta http-equiv="content-type" content="text/html; charset=UTF8">

    <link rel="stylesheet" media="all" href="../node_modules/socrata-styleguide/dist/css/styleguide.css">
    <link rel="stylesheet" media="all" href="../node_modules/leaflet/dist/leaflet.css">
    <link rel="stylesheet" media="all" href="../dist/socrata-visualizations.css">

    <style>
      #chart {
        display: block;
        position: relative;
        width: 640px;
        height: 490px;
      }
    </style>
  </head>

  <body>
    <button id="launch" class="btn btn-primary btn-block">Launch Authoring Workflow</button>

    <div id="authoring-workflow"></div>

    <pre id="output" style="white-space: pre-wrap;"></pre>
    <div id="chart"></div>
  </body>

  <!-- Include external vendor -->
  <script type="text/javascript" src="./vendor.js"></script>

  <!-- Include bundle -->
  <script type="text/javascript" src="../dist/socrata-visualizations.js"></script>

  <script type="text/javascript">
    var AuthoringWorkflow = socrata.visualizations.AuthoringWorkflow;
    var container = document.querySelector('#authoring-workflow');
    var output = document.querySelector('#output');
    var $chart = $('#chart');

    $('#launch').click(function() {
      output.innerHTML = '';
      $chart.empty();

      var productionTileServerHosts = [
        'https://tileserver1.api.us.socrata.com',
        'https://tileserver2.api.us.socrata.com',
        'https://tileserver3.api.us.socrata.com',
        'https://tileserver4.api.us.socrata.com'
      ];

      var stagingTileServerHosts = [
        'https://tileserver1.api.us.test-socrata.com',
        'https://tileserver2.api.us.test-socrata.com',
        'https://tileserver3.api.us.test-socrata.com',
      ];

      var choroplethVif = {
        configuration: {
          tileserverHosts: productionTileServerHosts
        },
        series: [
          {
            dataSource: {
              domain: 'dataspace.demo.socrata.com',
              datasetUid: '52my-2pak'
            }
          }
        ]
      };

      var ufoSightingsVif = {
        configuration: {
          tileserverHosts: stagingTileServerHosts
        },
        series: [
          {
            dataSource: {
              domain: 'vertex-stories.test-socrata.com',
              datasetUid: 'k6cs-ww27'
            }
          }
        ]
      };

      var featureMapVif = {
        configuration: {
          tileserverHosts: productionTileServerHosts
        },
        series: [
          {
            dataSource: {
              domain: 'dataspace.demo.socrata.com',
              datasetUid: 'r6t9-rak2'
            }
          }
        ]
      };

      var licenseeTax = {
        configuration: {
          tileserverHosts: stagingTileServerHosts
        },
        series: [
          {
            dataSource: {
              domain: 'vertex-stories.test-socrata.com',
              datasetUid: 'qnur-w9s6'
            }
          }
        ]
      };

      var iowaMathAndReadingProficiency = {
        configuration: {
          tileserverHosts: stagingTileServerHosts
        },
        series: [
          {
            dataSource: {
              domain: 'vertex-stories.test-socrata.com',
              datasetUid: 'vc2c-3mst'
            }
          }
        ]
      };

      var citizenSatisfaction = {
        configuration: {
          tileserverHosts: stagingTileServerHosts
        },
        series: [
          {
            dataSource: {
              domain: 'vertex-stories.test-socrata.com',
              datasetUid: 'tsij-fj78'
            }
          }
        ]
      };

      var authoringWorkflow = new AuthoringWorkflow(container, {
        //vif: choroplethVif,
        //vif: ufoSightingsVif,
        vif: featureMapVif,
        //vif: iowaMathAndReadingProficiency,
        //vif: licenseeTax,
        //vif: citizenSatisfaction,
        onComplete: function(result) {
          output.innerHTML = JSON.stringify(result.vif, null, 4);
          $chart.empty();

          switch (result.vif.series[0].type) {
            case 'columnChart':
              $chart.socrataSvgColumnChart(result.vif);
              break;
            case 'timelineChart':
              $chart.socrataSvgTimelineChart(result.vif);
              break;
            case 'featureMap':
              $chart.socrataFeatureMap(result.vif);
              break;
            case 'choroplethMap':
              $chart.socrataChoroplethMap(result.vif);
              break;
          }

          authoringWorkflow.destroy();
        },

        onCancel: function() {
          authoringWorkflow.destroy();
        }
      });
    });
  </script>
</html>
