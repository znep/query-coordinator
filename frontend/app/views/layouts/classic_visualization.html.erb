<html>

<!--
Powered by Socrata Publica
http://www.socrata.com
-->

  <head>
    <%= rendered_stylesheet_tag 'base' %>
    <%= jquery_include %>
    <%= rendered_stylesheet_tag 'dataset-show' %>
    <%= rendered_stylesheet_tag 'screen-classic-visualization' %>
    <%= csrf_meta_tags %>
  </head>
  <body class="<%= data_grid_body_class -%>" data-locale="<%= I18n.locale %>" data-defaultlocale="<%= CurrentDomain.default_locale %>">
    <div class="outerContainer">
      <div id="renderTypeContainer">
        <div class="staticRenderType fullHeight renderTypeNode hide">
        </div>
      </div>
    </div>

    <%= render_translations %>

    <%= include_webpack_bundle 'open-data/base.js' %>

    <%= render_view_js %>

    <script type="text/javascript">
      blist.feature_flags = <%= raw json_escape(FeatureFlags.derive(@view, request).to_json) %>;
      blist.rights = { user: <%= raw UserRights.to_h.to_json %>, view: <%= raw ViewRights.to_h.to_json %> };

      blist.namespace.fetch('blist.snapshot');
      blist.namespace.fetch('blist.configuration');

      blist.configuration.newChartsEnabled = <%= module_enabled?(:new_charts) || true %>;
      blist.configuration.newMapsEnabled = <%= module_enabled?(:new_maps) == true %>;
      blist.configuration.oldChartsForced = <%= module_enabled?(:old_charts) == true %>;
      blist.configuration.appToken = 'U29jcmF0YS0td2VraWNrYXNz0';
      blist.configuration.webpackManifest = <%= raw Rails.configuration.webpack[:asset_manifest].to_json %>;
      blist.configuration.assetRevisionKey = '<%= asset_revision_key %>';

      var csrfToken = $('meta[name="csrf-token"]').attr('content');

      $.ajaxSetup({
        beforeSend: function(xhrObj) {
          xhrObj.setRequestHeader('X-App-Token', blist.configuration.appToken);
          xhrObj.setRequestHeader('X-CSRF-Token', csrfToken);
        }
      });

      <%= raw render_inline_setup_js('renderTypeContainer', self) %>
    </script>

    <%= yield :javascripts %>
  </body>
</html>
