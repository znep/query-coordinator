<!DOCTYPE html>
<html>
  <head>
    <title>Example Usage: SvgTimelineChart.js</title>
    <meta charset="utf-8">
    <meta http-equiv="content-type" content="text/html; charset=UTF8">
    <link rel="stylesheet" media="all" href="../dist/socrata-visualizations.css">
    <!-- Include styleguide to test for style namespace collisions -->
    <link rel="stylesheet" media="all" href="../node_modules/socrata-components/dist/css/styleguide.css">
    <style type="text/css">

      body {
        font-size: 10px;
        font-family: sans-serif;
      }

      #timeline-chart-1,
      #timeline-chart-2,
      #timeline-chart-3,
      #timeline-chart-4,
      #timeline-chart-5,
      #timeline-chart-6,
      #timeline-chart-7 {
        display: block;
        position: relative;
        width: 640px;
        height: 480px;
        margin: 100px auto 0 auto;
      }
    </style>
  </head>
  <body>
    <p>With 'precision' set to 'DAY'</p>
    <div id="timeline-chart-1"></div>
    <p>Identical to the above except with 'precision' set to 'MONTH'</p>
    <div id="timeline-chart-2"></div>
    <p>Identical to the above except with 'precision' set to 'YEAR'</p>
    <div id="timeline-chart-3"></div>
    <p>Chart with null values</p>
    <div id="timeline-chart-4"></div>
    <p>Chart with null values and 'treatNullValuesAsZero' set to true</p>
    <div id="timeline-chart-5"></div>
    <p>Line variant with multiple series.
    <div id="timeline-chart-6"></div>
    <p>Version 1 vif, migrated at runtime to version 2. The data should be identical to the first chart on this page.
    <div id="timeline-chart-7"></div>
  </body>

  <!-- Include external vendor -->
  <script type="text/javascript" src="./vendor.js"></script>

  <!-- Include bundle -->
  <script type="text/javascript" src="../dist/socrata-visualizations.js"></script>

  <script type="text/javascript">

    $(document).ready(function() {

      /**
       * Set up VIFs
       */

      var COLUMN_NAME = 'date';
      var DATASET_UID = '52my-2pak';
      var DOMAIN = 'dataspace.demo.socrata.com';

      var timelineChart1Vif = {
        configuration: {
          axisLabels: {
            top: null,
            right: null,
            bottom: 'Date',
            left: 'Amount'
          }
        },
        description: 'Sample Description',
        series: [
          {
            dataSource: {
              datasetUid: DATASET_UID,
              dimension: {
                columnName: COLUMN_NAME,
                aggregationFunction: null
              },
              domain: DOMAIN,
              measure: {
                columnName: null,
                aggregationFunction: 'count'
              },
              type: 'socrata.soql',
              filters: [
                {
                  arguments: {
                    start: '2001-01-01T00:00:00.000',
                    end: '2003-06-01T00:00:00.000'
                  },
                  columnName: COLUMN_NAME,
                  function: 'timeRange'
                }
              ],
              precision: 'DAY'
            },
            label: 'Incidents',
            type: 'timelineChart',
            unit: {
              one: 'incident',
              other: 'incidents'
            }
          }
        ],
        createdAt: '2014-01-01T00:00:00',
        format: {
          type: 'visualization_interchange_format',
          version: 2
        },
        title: 'Sample Title'
      };

      var timelineChart2Vif = {
        configuration: {
          axisLabels: {
            top: null,
            right: null,
            bottom: 'Date',
            left: 'Amount'
          }
        },
        description: 'Sample Description',
        series: [
          {
            dataSource: {
              datasetUid: DATASET_UID,
              dimension: {
                columnName: COLUMN_NAME,
                aggregationFunction: null
              },
              domain: DOMAIN,
              measure: {
                columnName: null,
                aggregationFunction: 'count'
              },
              type: 'socrata.soql',
              filters: [
                {
                  arguments: {
                    start: '2001-01-01T00:00:00.000',
                    end: '2003-06-01T00:00:00.000'
                  },
                  columnName: COLUMN_NAME,
                  function: 'timeRange'
                }
              ],
              precision: 'MONTH'
            },
            label: 'Incidents',
            type: 'timelineChart',
            unit: {
              one: 'incident',
              other: 'incidents'
            }
          }
        ],
        createdAt: '2014-01-01T00:00:00',
        format: {
          type: 'visualization_interchange_format',
          version: 2
        },
        title: 'Sample Title'
      };

      var timelineChart3Vif = {
        configuration: {
          axisLabels: {
            top: null,
            right: null,
            bottom: 'Date',
            left: 'Amount'
          }
        },
        description: 'Sample Description',
        series: [
          {
            dataSource: {
              datasetUid: DATASET_UID,
              dimension: {
                columnName: COLUMN_NAME,
                aggregationFunction: null
              },
              domain: DOMAIN,
              measure: {
                columnName: null,
                aggregationFunction: 'count'
              },
              type: 'socrata.soql',
              filters: [
                {
                  arguments: {
                    start: '2001-01-01T00:00:00.000',
                    end: '2003-06-01T00:00:00.000'
                  },
                  columnName: COLUMN_NAME,
                  function: 'timeRange'
                }
              ],
              precision: 'YEAR'
            },
            label: 'Incidents',
            type: 'timelineChart',
            unit: {
              one: 'incident',
              other: 'incidents'
            }
          }
        ],
        createdAt: '2014-01-01T00:00:00',
        format: {
          type: 'visualization_interchange_format',
          version: 2
        },
        title: 'Sample Title'
      };

      var timelineChart4Vif = _.cloneDeep(timelineChart1Vif);
      _.set(timelineChart4Vif, 'series[0].dataSource.datasetUid', 'r6t9-rak2');
      _.set(timelineChart4Vif, 'series[0].dataSource.dimension.columnName', 'opened');
      _.set(timelineChart4Vif, 'series[0].dataSource.filters', []);
      _.unset(timelineChart4Vif, 'series[0].dataSource.precision');

      var timelineChart5Vif = _.cloneDeep(timelineChart1Vif);
      _.set(timelineChart5Vif, 'series[0].dataSource.datasetUid', 'r6t9-rak2');
      _.set(timelineChart5Vif, 'series[0].dataSource.dimension.columnName', 'opened');
      _.set(timelineChart5Vif, 'series[0].dataSource.filters', []);
      _.set(timelineChart5Vif, 'configuration.treatNullValuesAsZero', true);
      _.unset(timelineChart5Vif, 'series[0].dataSource.precision');

      var timelineChart6Vif = {
        configuration: {
          axisLabels: {
            top: null,
            right: null,
            bottom: 'School District',
            left: '% Proficient'
          }
        },
        description: 'Math proficiency by school district for 3rd graders in 2014',
        series: [
          {
            color: {
              primary: 'green'
            },
            dataSource: {
              datasetUid: 'qu5r-r47b',
              dimension: {
                columnName: 'reportweekending',
                aggregationFunction: null
              },
              domain: 'data.iowa.gov',
              measure: {
                columnName: 'initialclaims_ui',
                aggregationFunction: null
              },
              type: 'socrata.soql',
              filters: [
                {
                  arguments: {
                    start: '2003-01-01T00:00:00.000',
                    end: '2004-01-01T00:00:00.000'
                  },
                  columnName: 'reportweekending',
                  function: 'timeRange'
                }
              ]
            },
            label: 'Initial claims',
            type: 'timelineChart.line',
            unit: {
              one: 'claim',
              other: 'claims'
            }
          },
          {
            color: {
              primary: 'yellow'
            },
            dataSource: {
              datasetUid: 'qu5r-r47b',
              dimension: {
                columnName: 'reportweekending',
                aggregationFunction: null
              },
              domain: 'data.iowa.gov',
              measure: {
                columnName: 'continuedweeks_ui',
                aggregationFunction: null
              },
              type: 'socrata.soql',
              filters: [
                {
                  arguments: {
                    start: '2003-01-01T00:00:00.000',
                    end: '2004-01-01T00:00:00.000'
                  },
                  columnName: 'reportweekending',
                  function: 'timeRange'
                }
              ]
            },
            label: 'Continued weeks',
            type: 'timelineChart.line',
            unit: {
              one: 'claim',
              other: 'claims'
            }
          }
        ],
        createdAt: '2014-01-01T00:00:00',
        format: {
          type: 'visualization_interchange_format',
          version: 2
        },
        title: 'Claims'
      };

      var timelineChart7Vif = {
        aggregation: {
          field: null,
          function: 'count'
        },
        columnName: COLUMN_NAME,
        configuration: {
          viewSourceDataLink: true,
          axisLabels: {
            top: null,
            right: null,
            bottom: 'Date',
            left: 'Amount'
          },
          precision: 'DAY'
        },
        createdAt: '2014-01-01T00:00:00',
        datasetUid: DATASET_UID,
        domain: DOMAIN,
        filters: [
          {
            arguments: {
              start: '2001-01-01T00:00:00.000',
              end: '2002-06-01T00:00:00.000'
            },
            columnName: COLUMN_NAME,
            function: 'timeRange'
          }
        ],
        format: {
          type: 'visualization_interchange_format',
          version: 1
        },
        origin: {
          type: 'test_data',
          url: 'localhost'
        },
        title: COLUMN_NAME,
        type: 'timelineChart',
        unit: {
          one: 'case',
          other: 'cases'
        }
      };

      /**
       * Instantiate the plugins
       */

      var flyoutRenderer = new socrata.visualizations.views.FlyoutRenderer();

      var $timelineChart1Element = $('#timeline-chart-1');
      $timelineChart1Element.on('SOCRATA_VISUALIZATION_FLYOUT', handleFlyout);
      $timelineChart1Element.on('SOCRATA_VISUALIZATION_VIF_UPDATED', handleVifUpdated);
      $timelineChart1Element.socrataSvgTimelineChart(timelineChart1Vif);

      var $timelineChart2Element = $('#timeline-chart-2');
      $timelineChart2Element.on('SOCRATA_VISUALIZATION_FLYOUT', handleFlyout);
      $timelineChart2Element.on('SOCRATA_VISUALIZATION_VIF_UPDATED', handleVifUpdated);
      $timelineChart2Element.socrataSvgTimelineChart(timelineChart2Vif);

      var $timelineChart3Element = $('#timeline-chart-3');
      $timelineChart3Element.on('SOCRATA_VISUALIZATION_FLYOUT', handleFlyout);
      $timelineChart3Element.on('SOCRATA_VISUALIZATION_VIF_UPDATED', handleVifUpdated);
      $timelineChart3Element.socrataSvgTimelineChart(timelineChart3Vif);

      var $timelineChart4Element = $('#timeline-chart-4');
      $timelineChart4Element.on('SOCRATA_VISUALIZATION_FLYOUT', handleFlyout);
      $timelineChart4Element.on('SOCRATA_VISUALIZATION_VIF_UPDATED', handleVifUpdated);
      $timelineChart4Element.socrataSvgTimelineChart(timelineChart4Vif);

      var $timelineChart5Element = $('#timeline-chart-5');
      $timelineChart5Element.on('SOCRATA_VISUALIZATION_FLYOUT', handleFlyout);
      $timelineChart5Element.on('SOCRATA_VISUALIZATION_VIF_UPDATED', handleVifUpdated);
      $timelineChart5Element.socrataSvgTimelineChart(timelineChart5Vif);

      var $timelineChart6Element = $('#timeline-chart-6');
      $timelineChart6Element.on('SOCRATA_VISUALIZATION_FLYOUT', handleFlyout);
      $timelineChart6Element.on('SOCRATA_VISUALIZATION_VIF_UPDATED', handleVifUpdated);
      $timelineChart6Element.socrataSvgTimelineChart(timelineChart6Vif);

      var $timelineChart7Element = $('#timeline-chart-7');
      $timelineChart7Element.on('SOCRATA_VISUALIZATION_FLYOUT', handleFlyout);
      $timelineChart7Element.on('SOCRATA_VISUALIZATION_VIF_UPDATED', handleVifUpdated);
      $timelineChart7Element.socrataSvgTimelineChart(timelineChart7Vif);

      /**
       * Handle plugin events
       */

      function handleFlyout(event) {
        var payload = event.originalEvent.detail;

        // Render/hide a flyout
        if (payload !== null) {

          flyoutRenderer.render(payload);

        } else {

          flyoutRenderer.clear();
        }
      }

      function handleVifUpdated(event) {
        var payload = event.originalEvent.detail;
        var renderVifEvent = jQuery.Event('SOCRATA_VISUALIZATION_RENDER_VIF');

        renderVifEvent.originalEvent = {
          detail: payload
        };

        $(this).trigger(renderVifEvent);
      }

      /**
       * Destroy the plugins
       */

      // $timelineChart1Element.off('SOCRATA_VISUALIZATION_TIMELINE_CHART_FLYOUT', handleFlyout);
      // $timelineChart1Element.off('SOCRATA_VISUALIZATION_VIF_UPDATED', handleVifUpdated);
      // $timelineChart1Element.trigger('SOCRATA_VISUALIZATION_DESTROY');

      // $timelineChart2Element.off('SOCRATA_VISUALIZATION_TIMELINE_CHART_FLYOUT', handleFlyout);
      // $timelineChart2Element.off('SOCRATA_VISUALIZATION_VIF_UPDATED', handleVifUpdated);
      // $timelineChart2Element.trigger('SOCRATA_VISUALIZATION_DESTROY');

      // $timelineChart3Element.off('SOCRATA_VISUALIZATION_TIMELINE_CHART_FLYOUT', handleFlyout);
      // $timelineChart3Element.off('SOCRATA_VISUALIZATION_VIF_UPDATED', handleVifUpdated);
      // $timelineChart3Element.trigger('SOCRATA_VISUALIZATION_DESTROY');

      // $timelineChart4Element.off('SOCRATA_VISUALIZATION_TIMELINE_CHART_FLYOUT', handleFlyout);
      // $timelineChart4Element.off('SOCRATA_VISUALIZATION_VIF_UPDATED', handleVifUpdated);
      // $timelineChart4Element.trigger('SOCRATA_VISUALIZATION_DESTROY');

      // $timelineChart5Element.off('SOCRATA_VISUALIZATION_TIMELINE_CHART_FLYOUT', handleFlyout);
      // $timelineChart5Element.off('SOCRATA_VISUALIZATION_VIF_UPDATED', handleVifUpdated);
      // $timelineChart5Element.trigger('SOCRATA_VISUALIZATION_DESTROY');

      // $timelineChart6Element.off('SOCRATA_VISUALIZATION_TIMELINE_CHART_FLYOUT', handleFlyout);
      // $timelineChart6Element.off('SOCRATA_VISUALIZATION_VIF_UPDATED', handleVifUpdated);
      // $timelineChart6Element.trigger('SOCRATA_VISUALIZATION_DESTROY');
    });
  </script>
</html>
