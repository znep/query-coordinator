#!/usr/bin/env bash

set -e

if [ -z "${SITE_CHROME_LOCALEAPP_API_KEY}" ]; then
    echo "Need to set SITE_CHROME_LOCALEAPP_API_KEY"
    exit 1
fi

echo "Configuring bundler to use repo.socrata.com..."
set +x
bundle config repo.socrata.com "${ARTIFACTORY_USER}":"${ARTIFACTORY_PASSWORD}"
set -x

bundle check || bundle install
LOCALEAPP_API_KEY=${SITE_CHROME_LOCALEAPP_API_KEY} bundle exec rake socrata_site_chrome:gem:release
