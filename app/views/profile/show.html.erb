<% content_for :head do %>
  <%= stylesheet_link_tag "profile-screen" %>
  <title><%= t(:page_title) %></title>
<% end %>



<div class="twoColumnContainer clearfix">
  <div id="mainColumnContent" class="column mainContent">
    <div id='profile'>
      
      <%- if (@is_user_current) -%>
        <%= render(:partial => "shared/tabs") %>
      <%- end -%>

      <div class='outerContent<%= @is_user_current ? "" : " notabs" %>'>
        <div class='content'>


          <div class='userInfo clearfix'>

            <div class='profilePicture'>
              <%= image_tag(@user.profile_image_path("medium"),
                :size => "80x80", :alt => h(@user.displayName)) %>
              <%- if (@is_user_current) -%>
                <a id='changeProfileImage' class='action' href='<%= @user.
                  profile_image_path("replace").gsub("/replace", "") %>'>Change</a>
                <p class='errorMessage'></p>
              <%- end -%>
            </div>

            <div class="profileContent sectionContainer">
              <div class="sectionShow">
                <div class='userName'>
                  <h1>
                    <%= h(@user.displayName) %>
                  </h1>
                  <%- if (@is_user_current) -%>
                    <a class='first action showListBoxLink' href='#edit'>Edit</a>
                    <a id='switchUsernameLink' class='action'
                      href='#show_<%= @user.privacyControl == "login" ?
                        'fullName' : 'login' %>'>
                      Display <%= current_user.privacyControl == "login" ?
                        'Full Name' : 'Username' %>
                    </a>
                  <%- end -%>
                </div>
                <div class='userLocation'>
                  <h5><%= h(@user.displayLocation) %></h5>
                </div>
                <div class='userCompany'>
                  <h5><%= h(@user.company) %></h5>
                </div>
                <div class='userTitle'>
                  <h5><%= h(@user.title) %></h5>
                </div>
                <div class='userTags'>
                  <h5>Tags: <span class='tagContent'>
                      <%= @user.tag_display_string %>
                  </span></h5>
                </div>
              </div>
              <%- if (@is_user_current) -%>
                <div class="sectionEdit formListBox">
                  <div class="formListBoxTL"><div class="formListBoxTR">
                  <div class="formListBoxBL"><div class="formListBoxBR">
                    <% form_tag(profile_url(@user.login), :class => "clearfix") do %>
                      <dl class="clearfix">
                        <dt>Name Display</dt>
                        <dd>
                          <%= radio_button_tag("user[privacyControl]",
                          "fullName", @user.privacyControl == "fullName") %>
                          <label class="radioLabel"
                            for='user_privacyControl_fullname'>
                            Display Full Name
                          </label>
                          <%= radio_button_tag("user[privacyControl]",
                            "login", @user.privacyControl == "login") %>
                          <label class="radioLabel" for='user_privacyControl_login'>
                            Display Username
                          </label>
                        </dd>
                        <dt><label for="user_firstName">First Name</label></dt>
                        <dd>
                          <%= text_field_tag("user[firstName]",
                            h(@user.firstName)) %>
                        </dd>
                        <dt><label for="user_lastName">Last Name</label></dt>
                        <dd>
                          <%= text_field_tag("user[lastName]",
                            h(@user.lastName)) %>
                        </dd>
                        <dt><label for="user_login">Username</label></dt>
                        <dd>
                          <%= text_field_tag("user[login]", h(@user.login)) %>
                        </dd>
                        <dt><label for="user_company">Company</label></dt>
                        <dd>
                          <%= text_field_tag("user[company]", h(@user.company)) %>
                        </dd>
                        <dt class='sectionEnd'>
                          <label for="user_title">Title</label>
                        </dt>
                        <dd class='sectionEnd'>
                          <%= text_field_tag("user[title]", h(@user.title)) %>
                        </dd>
                        <dt><label for="user_city">City</label></dt>
                        <dd>
                          <%= text_field_tag("user[city]", h(@user.city)) %>
                        </dd>
                        <dt><label for="user_state">State</label></dt>
                        <dd>
                          <%= select_tag("user[state]",
                            us_state_select_options(@user.state)) %>
                        </dd>
                        <dt class='sectionEnd'>
                          <label for="user_country">Country</label>
                        </dt>
                        <dd class='sectionEnd'>
                          <%= select_tag("user[country]",
                            country_select_options(@user.country)) %>
                        </dd>
                        <dt><label for="user_tags">Tags</label></dt>
                        <dd>
                          <%= text_field_tag("user[tags]",
                            @user.tag_display_string) %>
                          <span class="fieldNote">(Separate tags with commas)</span>
                        </dd>
                      </dl>
                      <p class="formListBoxSubmit">
                        <%= image_submit_tag("button_save.png") %>
                      </p>
                      <p class='errorMessage'></p>
                    <% end %>
                    <p class="formListBoxClose"><a href="#close">Close</a></p>
                  </div></div>
                  </div></div>
                </div>
              <%- end -%>
            </div>
          </div>

          <h3>About Me</h3>
          <div class="descriptionContent sectionContainer">
            <div class="sectionShow">
              <p class="descriptionText"><%= @user.htmlDescription %></p>
              <%- if (@is_user_current) -%>
                <p>
                  <a class='action showListBoxLink' href='#edit'>Edit</a>
                </p>
              <%- end -%>
            </div>
            <%- if (@is_user_current) -%>
              <div class="sectionEdit formListBox">
                <div class="formListBoxTL"><div class="formListBoxTR">
                <div class="formListBoxBL"><div class="formListBoxBR">
                  <% form_tag(profile_url(@user.login), :class => "clearfix") do %>
                    <dl class="clearfix">
                      <dt><label for="user_description">Description</label></dt>
                      <dd>
                        <%= text_area_tag("user[description]",
                          h(@user.description), :class => "text_wide") %>
                      </dd>
                    </dl>
                    <p class="formListBoxSubmit">
                      <%= image_submit_tag("button_save.png") %>
                    </p>
                    <p class='errorMessage'></p>
                  <% end %>
                   <p class="formListBoxClose"><a href="#close">Close</a></p>
                </div></div>
                </div></div>
              </div>
            <%- end -%>
          </div>
          
          <h3>Interests</h3>
          <div class="interestsContent sectionContainer">
            <div class="sectionShow">
              <p class="interestsText"><%= h(@user.interests) %></p>
              <%- if (@is_user_current) -%>
                <p>
                  <a class='action showListBoxLink' href='#edit'>Edit</a>
                </p>
              <%- end -%>
            </div>
            <%- if (@is_user_current) -%>
              <div class="sectionEdit formListBox">
                <div class="formListBoxTL"><div class="formListBoxTR">
                <div class="formListBoxBL"><div class="formListBoxBR">
                  <% form_tag(profile_url(@user.login), :class => "clearfix") do %>
                    <dl class="clearfix">
                      <dt><label for="user_interests">Interests</label></dt>
                      <dd>
                        <%= text_area_tag("user[interests]",
                          h(@user.interests), :class => "text_wide") %>
                      </dd>
                    </dl>
                    <p class="formListBoxSubmit">
                      <%= image_submit_tag("button_save.png") %>
                    </p>
                    <p class='errorMessage'></p>
                  <% end %>
                   <p class="formListBoxClose"><a href="#close">Close</a></p>
                </div></div>
                </div></div>
              </div>
            <%- end -%>
          </div>
          
          <h3>Links</h3>
          <div class="linksContent sectionContainer">
            <div class="sectionShow">
              <ul class="userLinkActions clearfix">
                <%- #TODO: Make these links real and generated from the user's data. -%>
                <li><%= link_to(image_tag("share_delicious.png", :size => "32x32", :alt => "Delicious"), 
                        "http://delicious.com/#{@user.login}",
                        :title => "Delicious page for #{@user.displayName}", :rel => "external") %></li>
                <li><%= link_to(image_tag("share_digg_guy.png", :size => "32x32", :alt => "Digg"), 
                        "http://digg.com/users/#{@user.login}",
                        :title => "Digg profile for #{@user.displayName}", :rel => "external") %></li>
                <li><%= link_to(image_tag("share_logo_twitter.png", :size => "32x32", :alt => "Twitter"), 
                        "http://www.twitter.com/#{@user.login}",
                        :title => "Twitter page for #{@user.displayName}", :rel => "external") %></li>
              </ul>
              <%- if (@is_user_current) -%>
                <p>
                  <a class='action showListBoxLink' href='#edit'>Edit</a>
                </p>
              <%- end -%>
            </div>
            <%- if (@is_user_current) -%>
              <div class="sectionEdit formListBox">
                <div class="formListBoxTL"><div class="formListBoxTR">
                <div class="formListBoxBL"><div class="formListBoxBR">
                  <% form_tag(profile_url(@user.login), :class => "clearfix") do %>
                    <p>Soon, you'll be able to edit your links.</p>
                    <p class='errorMessage'></p>
                  <% end %>
                   <p class="formListBoxClose"><a href="#close">Close</a></p>
                </div></div>
                </div></div>
              </div>
            <%- end -%>
          </div>


          <div class='publicBlists'>
            <h3>My public <%= t(:blists_name) %> &amp; filters</h3>
            <div class='infoContentOuter active'><div class="infoContentInner">
              <div class='infoContent'>
                <div class='infoContentHeader'>
                  <div class='infoContentHeaderInner clearfix'>
                    <h2 class='panelHeader'>
                      <%= pluralize(@public_views.length, 'item') %> total
                    </h2>
                  </div>
                </div>

                <div class="gridListContainer">
                  <table class="gridList" cellspacing="0">
                    <colgroup>
                      <col class='type' />
                      <col class='name' />
                      <col class='views' />
                      <col class='copies' />
                      <col class='actionContainer' />
                    </colgroup>
                    <thead>
                      <tr>
                        <th class="type first" title="Type"><div>Type</div></th>
                        <th class="name"><div>Name</div></th>
                        <th class="views"><div>Views</div></th>
                        <th class="copies"><div>Copies</div></th>
                        <th class="actionContainer last"></th>
                      </tr>
                    </thead>
                    <tbody>
                      <%= render( :partial => "public_blist_row", 
                        :collection => @public_views) %>
                    </tbody>
                  </table>
                </div>

              </div>
            </div></div>
          </div>


        </div>
      </div>
    </div>
  </div>

  <div id="sidebar" class="column scrollContentColumn">
    <% render(:layout => "shared/sidebar_box",
      :locals => { :id => 'blistStats' } ) do %>
        <h4><%= @is_user_current ? "My" : "#{h(@user.displayName)}'s" %> Stats</h4>
        
        <p><strong>Joined on:</strong> <%= blist_date(@user.createdAt) %></p>
        <p><strong>Last login:</strong> <%= blist_date(@user.lastLogin) %></p>
        
        <dl>
          <%- if (@is_user_current &&  @private_blists && @private_views) -%>
            <dt><strong>Private <%= t(:blists_name) %>:</strong> <%= @private_blists.length %></dt>
            <dd><%= pluralize(@private_views.length, 'View') %></dd>
          <%- end -%>
          <dt><strong>Public <%= t(:blists_name) %> &amp; Views:</strong> <%= @user.publicBlists + @user.publicViews %></dt>
          <dd><%= pluralize(@user.publicViews, 'View') %></dd>
          <dd><%= @shared_views.length %> Shared</dd>

          <dt><strong>Friends:</strong> <%= @user.numberOfFriends %></dt>
          <%- if (@user.numberOfFriends > 0) -%>
          <dd class="userList">
            <ul class="userIconList clearfix">
              <%= render(:partial => "user_icon_item", :collection => @friends) %>
            </ul>
          </dd>
          <%- end -%>
          <dt><strong>Followers:</strong> <%= @user.numberOfFollowers %></dt>
          <%- if (@user.numberOfFollowers > 0) -%>
          <dd class="userList">
            <ul class="userIconList clearfix">
              <%= render(:partial => "user_icon_item", :collection => @followers) %>
            </ul>
          </dd>
          <%- end -%>
        </dl>
    <% end %>
  </div>
</div>

<% content_for :js_footer do %>
  <%= render(:partial => "shared/common_js") %>
  <%= javascript_include_tag "plugins/jquery.validate", "plugins/jquery.json",
    "plugins/jquery.tablesorter", "plugins/ajaxupload.3.0",
  "widgets/selectable-list", "widgets/combination-list",
  "screens/profile-screen", :cache => "cache/profiles_show_all" %>
<% end %>
