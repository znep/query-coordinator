<%- prerendered_cache @cache_key, @cached_fragment, :expires_in => 15.minutes do -%>

<% content_for :head do %>
<title><%= @page.name %></title>
<%= rendered_stylesheet_tag 'components' %>
<% end %>

<%- render_result = @page.render(@vars, !@minimal_render) -%>
<%- if render_result == false -%>
<%- raise Canvas2::NoContentError.new -%>

<%- else -%>
<%= raw render_result %>

<%- content_for :js_footer do -%>
  <%= render :partial => 'canvas_js', :locals => { :page => @page, :template => nil } %>
<%- end -%>

<%- end -%>
<%- content_for :js_footer do -%>
  <%= current_user_js %>
<%- end -%><%# if render_result %>

<%- end -%><%# prerendered_cache %>
