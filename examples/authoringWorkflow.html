<!DOCTYPE html>
<html>
  <head>
    <title>Example Usage: AuthoringWorkflow</title>
    <meta http-equiv="content-type" content="text/html; charset=utf-8">

    <link rel="stylesheet" media="all" href="../node_modules/socrata-components/dist/css/styleguide.css">
    <link rel="stylesheet" media="all" href="../node_modules/leaflet/dist/leaflet.css">
    <link rel="stylesheet" media="all" href="../dist/socrata-visualizations.css">

    <style>
      #chart {
        display: block;
        position: relative;
        width: 640px;
        height: 490px;
      }
    </style>
  </head>

  <body>
    <button id="launch" class="btn btn-primary btn-block">Launch Authoring Workflow</button>

    <div id="authoring-workflow"></div>

    <pre id="output" style="white-space: pre-wrap;"></pre>
    <div id="chart"></div>
    <button id="edit" class="btn btn-default">Edit</button>
  </body>

  <!-- Include external vendor -->
  <script type="text/javascript" src="./vendor.js"></script>

  <!-- Include bundle -->
  <script type="text/javascript" src="../dist/socrata-visualizations.js"></script>

  <script type="text/javascript">
    var vif;
    var authoringWorkflow;
    var AuthoringWorkflow = socrata.visualizations.AuthoringWorkflow;
    var VisualizationRenderer = socrata.visualizations.VisualizationRenderer;
    var container = document.querySelector('#authoring-workflow');
    var output = document.querySelector('#output');
    var chart = document.querySelector('#chart');
    var visualization;
    var onComplete = function(result) {
      vif = result.vif;
      output.innerHTML = JSON.stringify(result.vif, null, 2);
      chart.innerHTML = '';

      if (visualization) {
        visualization.destroy();
      }
      visualization = new VisualizationRenderer(result.vif, chart);

      authoringWorkflow.destroy();
    };

    var onCancel = function() {
      authoringWorkflow.destroy();
    };

    var onBack = function() {
      console.log('Back to somewhere!');
    };

    $('#launch').click(function() {
      output.innerHTML = '';
      vif = null;
      chart.innerHTML = '';

      var axisLabels = {
        top: 'Top Axis Label',
        right: 'Right Axis Label',
        bottom: 'Bottom Axis Label',
        left: 'Left Axis Label'
      };

      var choroplethVif = {
        format: {
          type: 'visualization_interchange_format',
          version: 2
        },
        series: [
          {
            dataSource: {
              domain: 'dataspace.demo.socrata.com',
              datasetUid: '52my-2pak'
            }
          }
        ]
      };

      var ufoSightingsVif = {
        configuration: {},
        format: {
          type: 'visualization_interchange_format',
          version: 2
        },
        series: [
          {
            dataSource: {
              domain: 'vertex-stories.test-socrata.com',
              datasetUid: 'k6cs-ww27'
            }
          }
        ]
      };

      var featureMapVif = {
        format: {
          type: 'visualization_interchange_format',
          version: 2
        },
        series: [
          {
            dataSource: {
              domain: 'dataspace.demo.socrata.com',
              datasetUid: 'r6t9-rak2'
            },
            type: "featureMap"
          }
        ]
      };

      var licenseeTax = {
        format: {
          type: 'visualization_interchange_format',
          version: 2
        },
        series: [
          {
            dataSource: {
              domain: 'vertex-stories.test-socrata.com',
              datasetUid: 'qnur-w9s6'
            }
          }
        ]
      };

      var iowaMathAndReadingProficiency = {
        format: {
          type: 'visualization_interchange_format',
          version: 2
        },
        configuration: {
          axisLabels: axisLabels
        },
        series: [
          {
            color: {
              primary: 'pink',
              highlight: 'indigo'
            },
            dataSource: {
              datasetUid: 'vc2c-3mst',
              dimension: {
                columnName: 'grade',
                aggregationFunction: null
              },
              domain: 'vertex-stories.test-socrata.com',
              measure: {
                columnName: 'proficient_2',
                aggregationFunction: 'sum'
              }
            },
            type: 'columnChart',
            unit: {
              one: 'Custom Unit',
              other: 'Custom Units'
            }
          }
        ],
        title: 'My Great Column Chart',
        description: 'Iowa Math and Reading Proficienty'
      };

      var citizenSatisfaction = {
        format: {
          type: 'visualization_interchange_format',
          version: 2
        },
        configuration: {},
        series: [
          {
            dataSource: {
              domain: 'vertex-stories.test-socrata.com',
              datasetUid: 'tsij-fj78'
            }
          }
        ]
      };

      var v1FeatureMapVif = {
        'aggregation': {
          'columnName': null,
          'function': 'count'
        },
        'columnName': 'point',
        'configuration': {
          'datasetMetadata': false,
          'hover': true,
          'panAndZoom': true,
          'locateUser': true,
          'baseLayerUrl': 'https://a.tiles.mapbox.com/v3/socrata-apps.ibp0l899/{z}/{x}/{y}.png',
          'baseLayerOpacity': 0.8
        },
        'createdAt': '2014-01-01T00:00:00',
        'datasetUid': 'r6t9-rak2',
        'description': 'useless description should be deleted in migration',
        'domain': 'dataspace.demo.socrata.com',
        'filters': [],
        'format': {
          'type': 'visualization_interchange_format',
          'version': 1
        },
        'origin': {
          'type': 'test_data',
          'url': 'localhost'
        },
        'title': 'useless title should be deleted in migration',
        'type': 'featureMap',
        'unit': {
          'one': 'record',
          'other': 'records'
        }
      };

      var localhost = {
        format: {
          type: 'visualization_interchange_format',
          version: 2
        },
        series: [
          {
            dataSource: {
              domain: 'localhost',
              datasetUid: '2k23-drn3'
            }
          }
        ]
      };

      var whiteHouseStaff = {
        format: {
          type: 'visualization_interchange_format',
          version: 2
        },
        series: [
          {
            dataSource: {
              domain: 'vertex-stories.test-socrata.com',
              datasetUid: '6ta3-xmf3'
            }
          }
        ]
      };

      var percentColumnNBEExample = {
        format: {
          type: 'visualization_interchange_format',
          version: 2
        },
        series: [
          {
            dataSource: {
              domain: 'ori-performance.demo.socrata.com',
              datasetUid: 'mkvz-3tmj'
            }
          }
        ]
      };

      var columnChartV1Vif = {
        'aggregation': {
          'columnName': null,
          'function': 'count'
        },
        'columnName': 'category',
        'configuration': {},
        'createdAt': '2014-01-01T00:00:00',
        'datasetUid': 'r6t9-rak2',
        'domain': 'dataspace.demo.socrata.com',
        'filters': [],
        'format': {
          'type': 'visualization_interchange_format',
          'version': 1
        },
        'origin': {
          'type': 'test_data',
          'url': 'localhost'
        },
        'title': 'Column: `category`',
        'type': 'columnChart',
        'unit': {
          'one': 'case',
          'other': 'cases'
        }
      };

      authoringWorkflow = new AuthoringWorkflow(container, {
        // vif: localhost,
        // vif: choroplethVif,
        vif: ufoSightingsVif,
        // vif: featureMapVif,
        // vif: iowaMathAndReadingProficiency,
        // vif: licenseeTax,
        // vif: citizenSatisfaction,
        // vif: whiteHouseStaff,
        // vif: v1FeatureMapVif,
        // vif: percentColumnNBEExample,
        backButtonText: 'Back to Dataset Selection',
        onComplete: onComplete,
        onCancel: onCancel,
        onBack: onBack,
        useLogger: true
      });
    });

    $('#edit').click(function() {
      if (vif) {
        authoringWorkflow = new AuthoringWorkflow(container, {
          vif: vif,
          onComplete: onComplete,
          onCancel: onCancel,
          useLogger: true
        });
      }
    });
  </script>
</html>
