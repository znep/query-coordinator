<%# locals: view, page_single  %>
<%- 
  isDuplicateEnabled = false
-%>
<%- 
  expander_class = page_single ? "expander expanded" : "expander" 
  div_shown = page_single ? "style='display:block;'" : ""
-%>
<%- is_owner = current_user && view.owner.id == current_user.id -%>
<div class="header">
  <ul class="summaryTabs clearfix">
    <li id="tabComments" class="comments active">
      <div class="tabOuter"><div class="tabInner active">
        <a href="#expand" class="<%= expander_class %>" title="more info">more info</a>
        <a href="#comments">Comments</a>
      </div></div>
    </li>
    <li id="tabSummary">
      <div class="tabOuter"><div class="tabInner">
        <a href="#expand" class="<%= expander_class %>" title="more info">more info</a>
        <a href="#summary">Summary</a>
      </div></div>
    </li>
    <li id="tabFiltered">
      <div class="tabOuter"><div class="tabInner">
        <a href="#expand" class="<%= expander_class %>" title="more info">more info</a>
        <a href="#filtered_views">Filtered Views</a>
      </div></div>
    </li>
    <li id="tabSharing">
      <div class="tabOuter"><div class="tabInner">
        <a href="#expand" class="<%= expander_class %>" title="more info">more info</a>
        <a href="#sharing_permissions">Sharing</a>
      </div></div>
    </li>
    <li id="tabPublishing">
      <div class="tabOuter"><div class="tabInner">
        <a href="#expand" class="<%= expander_class %>" title="more info">more info</a>
        <a href="#publishing">Publishing</a>
      </div></div>
    </li>
    <li id="tabActivity">
      <div class="tabOuter"><div class="tabInner">
        <a href="#expand" class="<%= expander_class %>" title="more info">more info</a>
        <a href="#activity">Activity</a>
      </div></div>
    </li>
  </ul>
</div>


<%# *** START: SUMMARY *** %>
<div class="infoContentOuter singleInfoSummary listContainer <%= page_single ? ' expanded' : '' %>">
  <div class="infoContentHeader clearfix">
    <%= render(:partial => "blists/info_summary_header",
                :locals => {:view => view, :page_single => page_single, 
                            :allow_edit => is_owner, :in_widget => false }) %>
  </div>
  <div class="infoContentInner"><div class="infoContentWrapper">
    <div class="infoContent"<%= div_shown %>>
      <%= render( :partial => "blists/meta_tab_summary", 
                  :locals => {:view => view, :page_single => page_single, 
                              :allow_edit => is_owner, :in_widget => false }) %>
    </div> <!-- /.infoContent -->
  </div></div> <!-- /.infoContentInner -->
</div>
<%# *** END: SUMMARY *** %>

<%# *** START: FILTERED *** %>
<div class="infoContentOuter singleInfoFiltered">
  <div class="infoContentHeader clearfix">
    <h2 class="panelHeader">
      <%= pluralize(view.filters.length, "Filtered View") %>
    </h2>
    <%- if current_user -%>
    <ul class="headerActions actionButtons">
      <li><%= link_to("Create", view.href + "?popup=SaveLens", :class => "arrowButton showFlashPopup") %></li>
    </ul>
    <%- end -%>
  </div>
  <div class="infoContentInner"><div class="infoContentWrapper">
    <div class="infoContent"<%= div_shown %>>
      <div class="gridListContainer">
        <table class="gridList" cellspacing="0">
          <colgroup>
            <col class='handle' />
            <col class='favorite' />
            <col class='type' />
            <col class='name' />
            <col class='description' />
            <col class='picture' />
            <col class='owner' />
            <col class='viewed' />
            <col class='actionContainer' />
          </colgroup>
          <thead>
            <tr>
              <th class="handle first"><div></div></th>
              <th class="favorite" title="Favorite?"><div>Favorite?</div></th>
              <th class="type" title="Type"><div>Type</div></th>
              <th class="name"><div>Name</div></th>
              <th class="description"><div>Description</div></th>
              <th class="picture" title="Owner"><div></div></th>
              <th class="owner" title="Owner"><div>Owner</div></th>
              <th class="viewed"><div>Visits</div></th>
              <th class="actionContainer last"></th>
            </tr>
          </thead>
          <tbody>
            <%- view.filters.each do |filter| -%>
              <tr class="item" id="filter-row_<%= filter.id %>">
                <td class="handle"><div></div></td>
                <td class="favorite <%= filter.flag?('favorite') %>"><div>
                    <span class="favoriteMarker"><%= filter.flag?('favorite') ? "favorite" : "" %></span>
                </div></td>
                <td class="type"><div class="<%=
                  get_share_direction_icon_class_for_view(filter) %>">
                  <%= get_type_string_for_view(filter) %></div>
                </td>
                <td class="name"><div><%= link_to(h(filter.name), filter.href) %></div></td>
                <td class="description"><div><%= h(filter.description) %></div></td>
                <td class="picture"><a href='<%= filter.owner.href %>'>
                    <%= image_tag(filter.owner.profile_image_path,
                    :size => "24x24", :alt => h(filter.owner.displayName)) %>
                </a></td>
                <td class="owner">
                  <div class='clipText'>
                    <a href='<%= filter.owner.href %>'
                      title='<%= h(filter.owner.displayName) %>'>
                      <%= h(filter.owner.displayName) %>
                    </a>
                  </div>
                </td>
                <td class="viewed"><div><%= blist_date(filter.last_viewed) %>
                </div></td>
                <td class="actionContainer"><div><a
                      href="<%= filter.href %>" class="action"
                      title="<%= h(filter.name) %>"><span>View</span></a>
                </div></td>
              </tr>
            <%- end -%>
          </tbody>
        </table>
      </div>


    </div>
  </div></div>
</div>
<%# *** END: FILTERED *** %>


<%# *** START: COMMENTS *** %>
<div class="infoContentOuter singleInfoComments listContainer
  active <%= page_single ? 'expanded' : '' %>">
  <div class="infoContentHeader clearfix">
    <%= render(:partial => "blists/info_comments_header", 
                :locals => {:view => view, :allow_commenting => true}) %>
  </div>
  <div class="infoContentInner"><div class="infoContentWrapper">
    <div class="infoContent"<%= div_shown %>>
      <%= render( :partial => "blists/meta_tab_comments", 
                  :locals => {:view => view, :allow_commenting => true }) %>
    </div>
  </div></div>
</div>
<%# *** END: COMMENTS *** %>


<%# *** START: SHARING *** %>
<div class="infoContentOuter singleInfoSharing">
  <div class="infoContentHeader clearfix">
    <%- shares = view.shares -%>
    <h2 class="panelHeader first"><%= pluralize(shares.length, 'Share') %></h2>
    <h2 class="panelHeader <%= view.shares.size > 0 ? '' : ' last' %> <%= get_permissions_icon_class_for_view(view) %>">
      <%= view.is_public? ? "Public" : "Private" %>
    </h2>
    <%- if view.shares.size > 0 %>
      <h2 class="panelHeader typeNotify last">
        <% form_tag(url_for(:controller => :blists, 
          :action => :notify_all_of_changes)) do %>
          <a href="#" id="notifyAll">Notify all of changes</a>
          <%= image_tag("/images/throbber.gif", 
                      :size => "16x16", 
                      :alt => "Notifying...", 
                      :id => "throbber") %>
        <% end %>
      </h2>
    <% end %>
    <%- if is_owner -%>
    <ul class="headerActions actionButtons">
      <li><a href="<%= "#{view.href}?popup=SharingEditor" %>"
        class="arrowButton showFlashPopup" title="Share">Share</a></li>
    </ul>
    <%- end -%>
    <div class="socialActions">
      <a href='#' title='Share on Social Networks' id='shareInfoLink'>Share on Social Networks</a>
	    <%= menu_tag(socialize_menu_options(view, 'shareInfoMenu')) %>
    </div>
    </ul>
    
  </div>
  <div class="infoContentInner"><div class="infoContentWrapper">
    <div class="infoContent"<%= div_shown %>>
      <div class="sharingSummary">
        <p class="<%= view.is_public? ? "public" : (view.is_shared? ?
          "privateShared" : "private") %>">
        This <%= view.is_blist? ? t(:blist_name) : "filter" %> is
        <%- if is_owner && view.tableOwner.id == view.owner.id -%>
        <a href='#toggle-permissions_<%= view.id %>'
          class='switchPermsLink'><%= view.is_public? ?
            "Public" : "Private" %></a>
        <%- else -%>
        <span><%= view.is_public? ? "Public" : "Private" %></span>
        <%- end -%>
        <%= view.is_shared? ? ' and shared with the following ' +
        (shares.length == 1 ? 'friend' : 'friend'.pluralize) + ':' : '' %>
        </p>
      </div>

      <div class="gridListContainer">
        <table class="gridList" cellspacing="0">
          <colgroup>
            <col class='picture' />
            <col class='contact' />
            <col class='role' />
            <col class='actionContainer' />
          </colgroup>
          <thead>
            <tr>
              <th class="picture" title="Friend"><div></div></th>
              <th class="contact" title="Friend">
                <div>Friend</div>
              </th>
              <th class="role" title="Role"><div>Role</div></th>
              <%# Not supported
              <th class="others"><div>Can Share w/ Others</div></th>
              <th class="opened"><div>Last Opened</div></th>
              %>
              <th class="actionContainer last"></th>
            </tr>
          </thead>
          <tbody>
            <%- view.shares.sort {|a,b|
              a.type <=> b.type ||
              a.member_name.downcase <=> b.member_name.downcase}.each do |s| -%>
            <tr class="item">
              <td class="picture">
                <div>
                  <%- if s.member_id -%>
                    <a href="<%= User.href(s.member_name, s.member_id) %>"><%= image_tag(s.member_image, :size => "24x24", :alt => h(s.member_name)) %></a>
                  <%- else -%>
                    <%= image_tag(s.member_image, :size => "24x24", :alt => h(s.member_name)) %>
                  <%- end -%>
                </div>
              </td>
              <td class="contact"><div><%= h(s.member_name) %></div></td>
              <td class="role"><div><%= s.type %></div></td>
              <%# Not supported
              <td class="others"><div>Yes</div></td>
              <td class="opened"><div>01/09/2009</div></td>
              %>
              <td class="actionContainer"><div>
                  <%- if s.member_id -%>
                    <a href="<%= User.href(s.member_name, s.member_id) %>" class="action"><span>View Profile</span></a>
                  <%- end -%>
              </div></td>
            </tr>
            <%- end -%>
          </tbody>
        </table>
      </div>
    </div>
  </div></div>
</div>
<%# *** END: SHARING *** %>

<%# *** START: PUBLISHING *** %>
<div class="infoContentOuter singleInfoPublishing">
  <div class="infoContentHeader clearfix">
    <h2 class="panelHeader">Publishing</h2>
    <%# Not supported
    <h2 class="panelHeader">3212 total views</h2>
    %>
  </div>
  <div class="infoContentInner"><div class="infoContentWrapper">
    <div class="infoContent"<%= div_shown %>>
      <div class="publishWarningWrapper <%= (view.is_public? || view.is_shared?) ? 'hide' : '' %>">
        <div class="publishWarning">
          <h2>Warning</h2>
          <p>
          This <%= view.is_blist? ? t(:blist_name).downcase : 'filter' %> is
          currently private.  Private <%= view.is_blist? ? t(:blist_name).downcase.pluralize : 'filters' %> 
          cannot be viewed in the Social Data Player.  Please
          set the privacy to public or shared before publishing.
          </p>
        </div>
      </div>
      <div class="publishContent <%= view.is_private? ? 'hide' : '' %>">
        <p>
        You can publish this <%= t(:blist_name).downcase %> and
        filtered views on your blog,
        websites and more by embedding a Social Data Player.  Simply copy and paste
        the following HTML into your site.
        </p>
        <div class="publishCode">
          <p>Embed this <%= view.is_blist? ? t(:blist_name).downcase : 'filter' %> as a Social Data Player:</p>
          <div class="sizeOptions">
            <p class="field">
              <label for="publishWidth">Width</label>
              <%= text_field_tag("publishWidth", "425") %> px
            </p>
            <p class="field">
              <label for="publishHeight">Height</label>
              <%= text_field_tag("publishHeight", "344") %> px
            </p>
            <p class="field">
              <label for="publishVariation">Color</label>
              <%= select_tag("publishVariation", options_for_select({ 'Blue' => '', 'Black' => 'black' })) %>
            </p>
            <p id="sizeError" class="hide">The player must be at least 425 pixels wide by 344 pixels tall.</p>
          </div>
          <div class="copyCode">
            <%= text_area_tag("publishCode") %>
            <%= hidden_field_tag("publishCodeTemplate", get_publish_embed_code_for_view(view, "#width#", "#height#", "#variation#")) %>
            <ul class="actionButtons">
              <li class="flushLeft"><a id="previewWidgetLink" href="<%= "/widgets_preview/#{view.id}" %>" class="arrowButton">See Preview</a></li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div></div>
</div>
<%# *** END: PUBLISHING *** %>

<%# *** START: ACTIVITY *** %>
<div class="infoContentOuter singleInfoActivity">
  <div class="infoContentHeader clearfix">
    <h2 class="panelHeader">Activity</h2>
    <ul class="headerActions actionButtons">
      <li><a href="<%= "#{view.href}/stats" %>" class="arrowButton">View Statistics</a></li>
    </ul>
  </div>
  <div class="infoContentInner"><div class="infoContentWrapper">
    <div class="infoContent"<%= div_shown %>>
      <div class="gridListContainer">
        <table class="gridList" cellspacing="0">
          <thead>
            <tr>
              <th class="when first" title="When"><div>When</div></th>
              <th class="picture" title="Who"><div></div></th>
              <th class="who" title="Who"><div>Who</div></th>
              <th class="what" title="What Activity"><div>What Activity</div></th>
              <th class="actionContainer last"></th>
            </tr>
          </thead>
          <tbody>
            <%- if @view_activities && @view_activities.length > 0 -%>
              <%- @view_activities.each do |activity| -%>
                <tr class="item">
                  <td class="when"><div><%= blist_date(activity.createdAt) %></div></td>
                  <td class="picture"><a href='<%= activity.actor.href %>'>
                      <%= image_tag(activity.actor.profile_image_path,
                      :size => "24x24", :alt => h(activity.actor.displayName)) %>
                  </a></td>
                  <td class="who"><div class='clipText'>
                      <a href="<%= activity.actor.href %>"
                        title='<%= h(activity.actor.displayName) %>'>
                      <%= h(activity.actor.displayName) %>
                    </a>
                  </div></td>
                  <td class="what"><div>
                    <%= get_verb_for_activity_action(activity.action) %>
                    <%= get_html_for_action_object(activity) %>
                  </div></td>
                  <td class="actionContainer"><div>
                    <a href="<%= get_url_for_activity_action(activity) %>" class="action"><span>View</span></a>
                  </div></td>
                </tr>
              <%- end -%>
            <%- else -%>
              <tr class="item">
                <td colspan="4"><div>
                  <p>There is no activity for this <%= t(:blist_name).downcase %>.</p>
                </div></td>
              </tr>
            <%- end -%>
          </tbody>
        </table>
      </div>
    </div>
  </div></div>
</div>
<%# *** END: ACTIVITY *** %>
