<!DOCTYPE html>
<html>
  <head>
    <title>Example Usage: Table.js</title>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <link rel="stylesheet" media="all" href="../dist/socrata-visualizations.css">
    <!-- Include styleguide to test for style namespace collisions -->
    <link rel="stylesheet" media="all" href="../node_modules/socrata-styleguide/dist/css/styleguide.css">
    <style type="text/css">

      body {
        font-size: 10px;
        font-family: sans-serif;
        margin: 0;
      }

      [id^=table-] {
        margin: 0 2%;
        width: 96%;
        height: 640px;
      }

    </style>
  </head>
  <body>
    <button id="kill-btn">Destroy all</button>
    <p>Chicago crimes, unfiltered</p>
    <div id="table-1"></div>
    <p>Chicago crimes filtered via VIF (description = POSS: CRACK)</p>
    <div id="table-2"></div>
    <p>Prod derived view filtered inherently (crime type = burglary)</p>
    <div id="table-3"></div>
    <p>Staging derived view filtered inherently (type = bunnies)</p>
    <div id="table-4"></div>
    <p>Tests rendering an error the table's dataset cannot be found</p>
    <div id="table-5"></div>
    <p>Tests rendering a table based on an OBE dataset</p>
    <div id="table-6"></div>
    <p>Tests rendering a table with specified column widths</p>
    <div id="table-7"></div>
    <p>Tests rendering a table directly from a version 2 vif</p>
    <div id="table-8"></div>
  </body>

  <!-- Include external vendor -->
  <script type="text/javascript" src="./vendor.js" charset="utf-8"></script>

  <!-- Include bundle -->
  <script type="text/javascript" src="../dist/socrata-visualizations.js"></script>

  <script type="text/javascript">

    var flyoutRenderer = new socrata.visualizations.views.FlyoutRenderer();

    var COLUMN_NAME = 'block';
    var DATASET_UID = '6zsd-86xi';
    var DOMAIN = 'data.cityofchicago.org';

    var table1VIF = {
      'aggregation': {
        'columnName': null,
        'function': 'count'
      },
      'configuration': {
        'order': [{
          ascending: true,
          columnName: COLUMN_NAME
        }]
      },
      'createdAt': '2014-01-01T00:00:00',
      'datasetUid': DATASET_UID,
      'description': 'Crazy things are sometimes seen at night in Mississippi...',
      'domain': DOMAIN,
      'filters': [],
      'format': {
        'type': 'visualization_interchange_format',
        'version': 1
      },
      'origin': {
        'type': 'test_data',
        'url': 'localhost'
      },
      'title': 'UFO Sightings',
      'type': 'table',
      'unit': {
        'one': 'case',
        'other': 'cases'
      }
    };

    var $table1Element = $('#table-1');
    $table1Element.socrataTable(table1VIF);

    var $table2Element = $('#table-2');
    var table2VIF = _.cloneDeep(table1VIF);
    table2VIF.filters = [
      {
        'function': 'binaryOperator',
        'columnName': 'description',
        'arguments': {
          'operator': '=',
          'operand': 'POSS: CRACK'
        }
      }
    ];
    $table2Element.socrataTable(table2VIF);

    var $table3Element = $('#table-3');
    var table3VIF = _.cloneDeep(table1VIF);
    table3VIF.columnName = 'crime_type';
    table3VIF.configuration.order = [{
      ascending: true,
      columnName: 'crime_type'
    }];
    table3VIF.datasetUid = 'kr2s-ychr';
    table3VIF.domain = 'stories.demo.socrata.com';
    $table3Element.socrataTable(table3VIF);

    var $table4Element = $('#table-4');
    var table4VIF = _.cloneDeep(table1VIF);
    table4VIF.columnName = 'crime_type';
    table4VIF.configuration.order = [{
      ascending: true,
      columnName: 'date'
    }];
    table4VIF.datasetUid = 'fhhu-4yqk';
    table4VIF.domain = 'vertex-stories.test-socrata.com';
    $table4Element.socrataTable(table4VIF);

    var $table5Element = $('#table-5');
    var table5VIF = _.cloneDeep(table4VIF);
    table5VIF.datasetUid = 'notf-ound';
    $table5Element.socrataTable(table5VIF);

    var $table6Element = $('#table-6');
    var table6VIF = _.cloneDeep(table1VIF);
    table6VIF.datasetUid = '7uf8-tam8';
    table6VIF.domain = 'opendata-demo.rc-socrata.com';
    table6VIF.configuration.allowObeDataset = true;
    table6VIF.configuration.order = [{
      ascending: true,
      columnName: 'plain_text'
    }];
    $table6Element.socrataTable(table6VIF);

    var $table7Element = $('#table-7');
    var table7VIF = _.cloneDeep(table1VIF);
    table7VIF.configuration.tableColumnWidths = [
      {"columnName":"id","width":66},
      {"columnName":"case_number","width":76},
      {"columnName":"date","width":86},
      {"columnName":"block","width":96},
      {"columnName":"iucr","width":106},
      {"columnName":"primary_type","width":116},
      {"columnName":"description","width":126},
      {"columnName":"location_description","width":136},
      {"columnName":"arrest","width":146},
      {"columnName":"domestic","width":156},
      {"columnName":"beat","width":166},
      {"columnName":"district","width":176},
      {"columnName":"ward","width":186},
      {"columnName":"community_area","width":196},
      {"columnName":"fbi_code","width":206},
      {"columnName":"x_coordinate","width":216},
      {"columnName":"y_coordinate","width":226},
      {"columnName":"year","width":236},
      {"columnName":"updated_on","width":246},
      {"columnName":"latitude","width":256},
      {"columnName":"longitude","width":266},
      {"columnName":"location","width":276}
    ];
    $table7Element.socrataTable(table7VIF);

    var $table8Element = $('#table-8');
    var table8VIF = {
      format: {
        type: 'visualization_interchange_format',
        version: 2
      },
      configuration: {
        order: [{
          ascending: true,
          columnName: COLUMN_NAME
        }]
      },
      description: 'Table description',
      series: [
        {
          color: {
          },
          dataSource: {
            datasetUid: DATASET_UID,
            dimension: {
              columnName: COLUMN_NAME,
              aggregationFunction: null
            },
            domain: DOMAIN,
            measure: {
              columnName: null,
              aggregationFunction: 'count'
            },
            type: 'socrata.soql',
            filters: []
          },
          label: null,
          type: 'table',
          unit: {
            one: 'case',
            other: 'cases'
          }
        }
      ],
      title: 'Table title'
    };
    $table8Element.socrataTable(table8VIF);

    var $tables = $('[id^=table-]');

    $(window).resize(function() {
      $tables.trigger('SOCRATA_VISUALIZATION_INVALIDATE_SIZE');
    });

    $tables.on('SOCRATA_VISUALIZATION_FLYOUT', function(event) {
      if (event.originalEvent.detail) {
        flyoutRenderer.render(event.originalEvent.detail);
      } else {
        flyoutRenderer.clear();
      }
    });

    $tables.on('SOCRATA_VISUALIZATION_VIF_UPDATED', function(event) {
      console.log('VIF UPDATED', event.originalEvent.detail);
    });



    /**
     * Destroy the plugin.
     *
     * The plugin (and all internal modules) can be destroyed by triggering
     * `destroy` on the element.
     */
    $('#kill-btn').click(function() { $tables.trigger('SOCRATA_VISUALIZATION_DESTROY'); });
  </script>
</html>
