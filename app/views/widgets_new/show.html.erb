<% content_for :head do %>
  <link type="text/css" rel="stylesheet" href="/styles/widget/<%= params[:customization_id] %>.css" />
<% end %>

<div class="widgetWrapper">
  <%- if @theme[:toolbar][:position] = 'top' -%>
    <%= render :partial => 'widget_header' %>
    <%= render :partial => 'widget_subheader' %>
  <%- end -%>

  <div class="widgetContent">
    <div class="widgetContentGrid">
      <%- if @theme[:behavior][:save_public_views] -%>
        <div id='viewHeader' class='clearfix'>
          <a class='datasetLink breadcrumbItem' href='#view_<%= @view.id %>'><%= @view.name %></a>
          <div class='viewName inlineEdit' href='#new_view'>
            <span title='Click to name and save your filtered view'>
              [Unsaved Filter]
            </span>
            <%- form_tag(blists_path) do -%>
            <label for='view_name'>View Name:</label>
            <%= text_field_tag("view[name]", '') %>
            <%- end -%>
          </div>
        </div>
      <%- end -%>
      <div class="gridContainer">
        <%- if !@view.is_invalid? -%>
          <div id="data-grid">
            <noscript>
              <h3><a href="<%= @view.href %>"><%= @view.name %></a></h3>

              <p><%= @view.description %></p>

              <%- if @view.can_read -%>
              <% cache ['widget-bare-html', @view.id], :expires_in => 1.hour do %>
                <%= @view.html %>
              <% end %>
              <%- end -%>
            </noscript>
          </div>
        <%- else -%>
          <div class='viewErrorContainer content'>
            <%- if current_user.id == @view.owner.id -%>
            <div class='viewError'><%= @view.message %></div>
            <ul class='actionButtons clearfix'>
              <li><a href="<%= @view.href %>" rel="external"
                class='arrowButton'>Edit View</a></li>
            </ul>
            <%- else -%>
            <div class='viewError'>Unable to display this view.</div>
            <%- end -%>
          </div>
        <%- end -%>
      </div>
      </div>
      </div>
    </div>
  </div>
</div>