<div class="card-spot"
     animate-to="cardState.style"
     animate-to-index="{{ cardState.index }}"
     ng-repeat="cardState in cardStates track by cardState.model.uniqueId">
  <card model="cardState.model"
        class="card"
        where-clause="globalWhereClauseFragment"
        interactive="true"
        ng-class="{ expanded: cardState.model.getCurrentValue('expanded'), dragged: cardState.model === grabbedCard.model }"></card>
  <div class="card-drop-placeholder"
    ng-if="cardState.model === grabbedCard.model && cardState.model.fieldName !== '*'"
    ></div>
  <div ng-if="chooserMode.show"
    class="card-chooser overlay"
    ng-class="{enabled: isPngExportable(cardState.model)}"
    >
    <button class="action-btn"
            ng-click="downloadPng(cardState.model)"
            ng-class="{'export-visualization-disabled': !isPngExportable(cardState.model),
                       disabled: !isPngExportable(cardState.model),
                       active: downloadingCard === cardState.model}"
            >Download
      <spinner ng-if="downloadingCard === cardState.model"></spinner>
    </button>
  </div>
  <div class="card-drag-overlay overlay"
    data-card-id="{{cardState.model.uniqueId}}"
    ng-if="editMode && cardState.model !== grabbedCard.model && cardState.model.fieldName !== '*'">
    <div class="card-controls">
      <div class="card-control icon-settings"
           ng-class="{disabled: !isCustomizable(cardState.model)}"
           ng-click="customizeCard(cardState.model)"
           title="{{ isCustomizable(cardState.model) ? 'Customize this card' : 'There are no customization options for this card yet' }}"></div>
      <div class="card-control icon-close"
           title="Remove this card"
           ng-click="deleteCard(cardState.model)"></div>
    </div>
  </div>
</div>

<div ng-repeat="placeholder in placeholderDropTargets"
  ng-style="placeholder.style"
  class="card-group-drop-placeholder"
  data-group-id="{{ placeholder.cardSize}}"></div>
<button
  ng-repeat="button in addCardButtons"
  ng-style="button.style"
  type="button"
  class="add-card-button action-btn dark l-to-r"
  ng-class="{disabled: !allowAddCard}"
  ng-show="editMode"
  ng-click="addCard(button.cardSize)">Add card here</button>

<modal-dialog
  ng-if="addCardState.show"
  dialog-state="addCardState"
  >
  <add-card-dialog
    card-models="cardModels"
    card-size="cardSize"
    on-customize-card="customizeCard"
    dataset-columns="datasetColumns"
    dialog-state="addCardState"
    page="page"
    ></add-card-dialog>
</modal-dialog>

<modal-dialog
  class="second"
  ng-if="customizeState.show"
  dialog-state="customizeState">
  <customize-card-dialog
    card-model="cardModel"
    dialog-state="customizeState"
    page="page"
  />
</modal-dialog>
