<%- prefix = 'screens.admin.georegions' %>
<%- no_js = params[:no_js].present? -%>

<% content_for :head do %>
  <%= rendered_stylesheet_tag 'administration-screen' %>
  <%= rendered_stylesheet_tag 'administration-georegions' %>
  <title><%= t("#{prefix}.title") %> | <%= @view_model.site_title %></title>
<% end %>

<% content_for :skip_links do %>
  <%= link_to t('core.no_js'), '?no_js=true' %>
<% end %>

<%= render :partial => 'left_nav' %>

<div class="contentBox withLeftNavigation georegionsScreen">
  <div id="flash-container"><%= display_standard_flashes %></div>
  <div class="adminHeader floating georegions">
    <span class="icon"></span>

    <h1><%= t("#{prefix}.page_title") %></h1>
    <h4 id="georegions-page-subtitle"><span><%= t("#{prefix}.page_subtitle", :enabled_count => @view_model.enabled_count, :available_count => @view_model.maximum_enabled_count) %></span></h4>
  </div>
</div>


<div class="contentBox withLeftNavigation georegionsScreen">
  <div class="georegions-custom">
    <div class="clearfix">
      <h1 class="georegions-title-custom"><%= t("#{prefix}.custom_georegions") %></h1>

      <div class="georegions-controls-custom">
        <%= form_button(
          { :action => 'add_georegion' },
          t("#{prefix}.add_new"),
          { :method => :post },
          { :class => 'button', 'data-action' => 'add' }) %>
      </div>
    </div>

    <%= render :partial => 'georegions_table', :locals => {
        :allow_actions => true,
        :allow_enablement => @view_model.allow_enablement?,
        :georegions => @view_model.custom_regions,
        :limit => @view_model.maximum_enabled_count,
        :prefix => prefix
      } %>
  </div>
</div>

<%- content_for :modals do -%>
  <%= render :partial => 'modals/select_georegion', :locals => { :title => t("#{prefix}.choose_a_dataset") } %>
  <div class="modalDialog" id="react-modal"></div>
<%- end -%>

<% content_for :js_footer do %>
  <%- unless params[:no_js] == 'true' -%>
    <script type="text/javascript" id="bar">
      blist.namespace.fetch('blist.georegions').georegions = <%== @view_model.curated_regions.map {|region| region.name = j(region.name); region }.to_json %>;
      blist.namespace.fetch('blist.georegions').maximumEnabledCount = <%== @view_model.maximum_enabled_count.to_json %>;
      blist.namespace.fetch('blist.georegions').flash = <%== flash.map { |type, message| { :type => type, :message => message } }.to_json %>;
    </script>
    <%- if Rails.env.production? -%>
      <%= include_javascripts 'react-prod' %>
    <%- else -%>
      <%= include_javascripts 'react-dev' %>
    <%- end -%>
    <%= include_javascripts 'admin-georegions' %>
  <%- end -%>
<% end %>
<%= render_translations @view_model.translations %>
