<div class="editAccountForm editForm">
  <h1>Account Settings</h1>

  <%= display_standard_flashes %>
  <%- openid_identifiers = current_user.openid_identifiers -%>
  <% form_tag(update_account_profile_path, :method => 'put',
       :class => 'commonForm' + (openid_identifiers.empty? ? '' : ' hasOpenId'),
       :id => 'editAccountForm') do %>
    <div class="editArea">
      <%- unless current_user.flag?('nopassword') -%>
        <div class="editSection clearfix">
          <div class="line clearfix">
            <label>Current Email</label>
            <span class="field textItem"><%= current_user.email %></p>
          </div>
          <div class="line clearfix">
            <label for="user_email">New Email</label>
            <%= text_field_tag('user[email]', '', :class => 'textPrompt email') %>
          </div>
          <div class="line clearfix">
            <label for="user_email_confirm">Confirm Email</label>
            <%= text_field_tag('user[email_confirm]', '', :class => 'textPrompt email') %>
          </div>
          <div class="line clearfix">
            <label for="user_email_password">Password</label>
            <%= password_field_tag('user[email_password]', '') %>
            <span class="fieldHint textItem">
              (For your security)
            </span>
          </div>
        </div>
      <%- end -%>

      <div class="editSection clearfix">
        <h3>Password</h3>
        <div class="line clearfix">
          <label for="user_password_old">Old Password</label>
          <%= password_field_tag('user[password_old]', '', :class => 'currentPassword' + 
              (current_user.flag?('nopassword') ? ' noPassword' : '')) %>
        </div>
        <div class="line clearfix">
          <label for="user_password_new">New Password</label>
          <%= password_field_tag('user[password_new]', '', :class => 'newPassword') %>
        </div>
        <div class="line clearfix">
          <label for="user_password_confirm">Confirm Password</label>
          <%= password_field_tag('user[password_confirm]', '', :class => 'confirmPassword') %>
        </div>
      </div>

      <div class="editSection clearfix">
        <h3 class="unfixed">External Accounts</h3>
        <h4>Log in with your Facebook, Twitter, Google, or other 3rd-party credentials.
          <%= link_to "Learn about OpenID", openid_explained_url(account_url) %></h4>

        <%- if openid_identifiers.empty? -%>
          <p class="textItem">You have no OpenID identifiers associated with this account yet.<p>
        <%- else -%>
          <%- openid_identifiers.each do |ident| -%>
            <div class="line clearfix">
              <label>Delete</label>
              <span class="field textItem">
                <%= check_box_tag "openid_delete[#{ident.id}]" %>
                <%= hidden_field_tag "openid_delete_paths[#{ident.id}]", ident.delete_path %>
                <%= link_to ident.identifier %>
              </span>
            </div>
          <%- end -%>
        <%- end -%>
        <div class="line">
          <label>&nbsp;</label>
          <%= link_to_rpx raw('<span class="icon"></span>Add an OpenID or External Account'), add_rpx_token_url(:section => 'openid'), :class => 'rpxnow button add addOpenIdButton' %>
        </div>
      </div>
    </div>

    <div class="submitLine">
      <%= submit_tag 'Save Changes', :class => 'button default' %>
      <%= link_to 'Cancel', current_user.href, :class => 'button' %>
    </div>
  <% end %>
</div>

<% content_for :js_footer do %>
  <script src="https://rpxnow.com/openid/v2/widget" type="text/javascript"></script>
  <script type="text/javascript">
    RPXNOW.overlay = true;
    RPXNOW.language_preference = 'en';
    RPXNOW.flags='show_provider_list';
  </script>
<% end %>
