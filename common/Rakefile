def npm(command, path: 'karma_config')
  sh("cd #{path} && npm #{command}") do |ok, res|
    yield(ok, res) if block_given?
  end
end

def bundle(command, path: 'site_chrome')
  sh("cd #{path} && bundle #{command}") do |ok, res|
    yield(ok, res) if block_given?
  end
end

def rspec(path)
  sh("cd #{path} && rspec") do |ok, res|
    yield(ok, res) if block_given?
  end
end

def guard(path)
  sh("cd #{path} && guard") do |ok, res|
    yield(ok, res) if block_given?
  end
end

Dir.glob('tasks/*.rake').each(&method(:load))
# Load tasks from site_chrome.
Dir.glob('site_chrome/lib/tasks/*.rake').each(&method(:load))

desc 'Run linter'
task lint: :deps do
  npm('run lint') do |ok, res|
    raise 'Link failed' unless ok
  end
end

task :deps do
  Rake.application['karma:deps'].invoke
  Rake.application['rspec:deps'].invoke
end

desc 'Run lint and tests'
task default: %i(lint test)

desc 'Run all tests'
task test: %i(karma spec)
